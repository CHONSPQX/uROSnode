<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--
Copyright (c) 2012, Politecnico di Milano. All rights reserved.
Andrea Zoppi <texzk@email.it>
Martino Migliavacca <martino.migliavacca@gmail.com>
http://airlab.elet.polimi.it/
http://www.openrobots.com/
Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are met:
1. Redistributions of source code must retain the above copyright notice, this
   list of conditions and the following disclaimer.
2. Redistributions in binary form must reproduce the above copyright notice,
   this list of conditions and the following disclaimer in the documentation
   and/or other materials provided with the distribution.
THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR
ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Î¼ROSnode</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png" width="125" height="50"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname"><span id="projectnumber">0.1.0</span></div>
   <div id="projectbrief">alpha</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('uros_node_8c_source.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">urosNode.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="uros_node_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">Copyright (c) 2012, Politecnico di Milano. All rights reserved.</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">Andrea Zoppi &lt;texzk@email.it&gt;</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">Martino Migliavacca &lt;martino.migliavacca@gmail.com&gt;</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">http://airlab.elet.polimi.it/</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">http://www.openrobots.com/</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">Redistribution and use in source and binary forms, with or without</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">modification, are permitted provided that the following conditions are met:</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">1. Redistributions of source code must retain the above copyright notice, this</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">   list of conditions and the following disclaimer.</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">2. Redistributions in binary form must reproduce the above copyright notice,</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">   this list of conditions and the following disclaimer in the documentation</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">   and/or other materials provided with the distribution.</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment"> * @file    urosNode.c</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment"> * @author  Andrea Zoppi &lt;texzk@email.it&gt;</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment"> * @brief   Node features of the middleware.</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">/*===========================================================================*/</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">/* HEADER FILES                                                              */</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">/*===========================================================================*/</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &quot;../include/urosBase.h&quot;</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &quot;../include/urosUser.h&quot;</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#include &quot;../include/urosNode.h&quot;</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#include &quot;../include/urosRpcCall.h&quot;</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#include &quot;../include/urosRpcParser.h&quot;</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#include &quot;../include/lld/uros_lld_node.h&quot;</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment">/*===========================================================================*/</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">/* LOCAL TYPES &amp; MACROS                                                      */</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment">/*===========================================================================*/</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="preprocessor">#if UROS_NODE_C_USE_ASSERT == UROS_FALSE &amp;&amp; !defined(__DOXYGEN__)</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#undef urosAssert</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define urosAssert(expr)</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">/*===========================================================================*/</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment">/* GLOBAL VARIABLES                                                          */</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment">/*===========================================================================*/</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment"> * @brief   Node singleton.</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00067"></a><span class="lineno"><a class="code" href="uros_node_8c.html#a87ebbeb87be6c83d31d42c096913a711">   67</a></span>&#160;<a class="code" href="struct_uros_node.html" title="Node object.">UrosNode</a> <a class="code" href="uros_node_8h.html#a87ebbeb87be6c83d31d42c096913a711" title="Node singleton.">urosNode</a>;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">/*===========================================================================*/</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">/* GLOBAL FUNCTIONS                                                          */</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">/*===========================================================================*/</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">/** @addtogroup node_funcs */</span><span class="comment"></span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">/** @{ */</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment"> * @brief   Initializes a node object.</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment"> * @details This procedure:</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment"> *          - loads a nullified configuration</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment"> *          - initializes the status lists</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment"> *          - initializes the status locks</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment"> *          - initializes and allocates memory pools</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment"> *          - initializes thread pools</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment"> * @pre     The node has not been initialized yet.</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment"> * @param[in,out] np</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment"> *          Pointer to the @p UrosNode to be initialized.</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00090"></a><span class="lineno"><a class="code" href="group__node__funcs.html#gaf5abd468ab3b1e1d8623df84b88df5d2">   90</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__node__funcs.html#gaf5abd468ab3b1e1d8623df84b88df5d2" title="Initializes a node object.">urosNodeObjectInit</a>(<a class="code" href="struct_uros_node.html" title="Node object.">UrosNode</a> *np) {</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  <a class="code" href="struct_uros_node_status.html" title="Node status record.">UrosNodeStatus</a> *stp;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(np != NULL);</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  <span class="comment">/* Invalidate configuration variables.*/</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  memset((<span class="keywordtype">void</span>*)&amp;np-&gt;<a class="code" href="struct_uros_node.html#adc952e6ab7c3a6fa73a3f35f445dce8b" title="Node configuration (loaded at boot time).">config</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="struct_uros_node_config.html" title="Node configuration descriptor.">UrosNodeConfig</a>));</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  <span class="comment">/* Initialize status variables.*/</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  stp = &amp;np-&gt;<a class="code" href="struct_uros_node.html#a5824c0ae5741fd90f941e81ce22fac13" title="Node status.">status</a>;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  stp-&gt;<a class="code" href="struct_uros_node_status.html#a6008c8b42f1b334cb687cb398ed30e0c" title="PID of the XMLRPC Listener process.">xmlrpcPid</a> = ~0;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  <a class="code" href="group__base__funcs.html#ga44e0ce54ba23fc5f0d5d505356867837" title="Initializes a list object.">urosListObjectInit</a>(&amp;stp-&gt;<a class="code" href="struct_uros_node_status.html#ac1b16540d46ba17899d6a1d715ec8ffd" title="List of topic subscriptions.">subTopicList</a>);</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  <a class="code" href="group__base__funcs.html#ga44e0ce54ba23fc5f0d5d505356867837" title="Initializes a list object.">urosListObjectInit</a>(&amp;stp-&gt;<a class="code" href="struct_uros_node_status.html#a01c083cd0b765e45e9f4615b18b8f681" title="List of topic publications.">pubTopicList</a>);</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  <a class="code" href="group__base__funcs.html#ga44e0ce54ba23fc5f0d5d505356867837" title="Initializes a list object.">urosListObjectInit</a>(&amp;stp-&gt;<a class="code" href="struct_uros_node_status.html#af9e382b0941d31b46d918e1dbac524bc" title="List of published services.">pubServiceList</a>);</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  <a class="code" href="group__base__funcs.html#ga44e0ce54ba23fc5f0d5d505356867837" title="Initializes a list object.">urosListObjectInit</a>(&amp;stp-&gt;<a class="code" href="struct_uros_node_status.html#a808a345aa9bf26dccaf5c348b4da5ec7" title="List of parameter subscriptions.">subParamList</a>);</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  <a class="code" href="group__base__funcs.html#ga44e0ce54ba23fc5f0d5d505356867837" title="Initializes a list object.">urosListObjectInit</a>(&amp;stp-&gt;<a class="code" href="struct_uros_node_status.html#ac9a7d523859b45d5bc6d245114c25121" title="Subscribed TCPROS connections.">subTcpList</a>);</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  <a class="code" href="group__base__funcs.html#ga44e0ce54ba23fc5f0d5d505356867837" title="Initializes a list object.">urosListObjectInit</a>(&amp;stp-&gt;<a class="code" href="struct_uros_node_status.html#a44033dba5661df70b4a8cc19114e57ff" title="Published TCPROS connections.">pubTcpList</a>);</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  <a class="code" href="group__threading__funcs.html#ga37994e1b40b726a446c246de9ab8af6e" title="Initializes a mutex.">urosMutexObjectInit</a>(&amp;stp-&gt;<a class="code" href="struct_uros_node_status.html#ab5400f7ff78848f07e749d38ea422875" title="PID lock.">xmlrpcPidLock</a>);</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  <a class="code" href="group__threading__funcs.html#ga37994e1b40b726a446c246de9ab8af6e" title="Initializes a mutex.">urosMutexObjectInit</a>(&amp;stp-&gt;<a class="code" href="struct_uros_node_status.html#afe2468e629b5497699cdd79b3e134f95" title="Topic subscriptions lock.">subTopicListLock</a>);</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  <a class="code" href="group__threading__funcs.html#ga37994e1b40b726a446c246de9ab8af6e" title="Initializes a mutex.">urosMutexObjectInit</a>(&amp;stp-&gt;<a class="code" href="struct_uros_node_status.html#a6e0bf4f06068497a8254ff5b5341d1b5" title="Topic publications lock.">pubTopicListLock</a>);</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  <a class="code" href="group__threading__funcs.html#ga37994e1b40b726a446c246de9ab8af6e" title="Initializes a mutex.">urosMutexObjectInit</a>(&amp;stp-&gt;<a class="code" href="struct_uros_node_status.html#aea5546bf63f7cabcaebc7e377d50ca68" title="Publisher connections lock.">pubServiceListLock</a>);</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  <a class="code" href="group__threading__funcs.html#ga37994e1b40b726a446c246de9ab8af6e" title="Initializes a mutex.">urosMutexObjectInit</a>(&amp;stp-&gt;<a class="code" href="struct_uros_node_status.html#a5dc9190bee28e9ded208382d733df660" title="Parameter subscriptions lock.">subParamListLock</a>);</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  <a class="code" href="group__threading__funcs.html#ga37994e1b40b726a446c246de9ab8af6e" title="Initializes a mutex.">urosMutexObjectInit</a>(&amp;stp-&gt;<a class="code" href="struct_uros_node_status.html#a7d3e5ce542819c78c50f7acc533a87e3" title="Subscribed connections lock.">subTcpListLock</a>);</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  <a class="code" href="group__threading__funcs.html#ga37994e1b40b726a446c246de9ab8af6e" title="Initializes a mutex.">urosMutexObjectInit</a>(&amp;stp-&gt;<a class="code" href="struct_uros_node_status.html#aaccf2d5947dbe2c31b727e0f8a7a775e" title="Published connections lock.">pubTcpListLock</a>);</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  <span class="comment">/* Initialize stack pools.*/</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  <a class="code" href="group__user__funcs.html#ga1de2142a2a02aaf5113c029b2968b144" title="Initializes and allocates memory pools.">urosUserAllocMemPools</a>(np);</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <span class="comment">/* Initialize thread pools.*/</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  <a class="code" href="group__threading__funcs.html#gaf5bcef4a97d45aeb65b10c8c6d2c3ee0" title="Initializes a thread pool.">urosThreadPoolObjectInit</a>(&amp;stp-&gt;<a class="code" href="struct_uros_node_status.html#a8ae6ed5d1ecfedf5e5b0d446e7729e2c" title="TCPROS Client worker thread pool.">tcpcliThdPool</a>, &amp;stp-&gt;<a class="code" href="struct_uros_node_status.html#a76a054f3b7cd4f8cdb5892c97465fd0c" title="TCPROS Client worker stack pool.">tcpcliMemPool</a>,</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                           (<a class="code" href="group__base__types.html#ga7f1ff17e59a50f61ce7e3c18fdae5306" title="One-parameter procedure function pointer.">uros_proc_f</a>)<a class="code" href="group__tcpros__funcs.html#ga49843d8a86d3164a3c318b7afa456332" title="TCPROS Client worker thread.">urosTcpRosClientThread</a>,</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                           <span class="stringliteral">&quot;TcpRosClient&quot;</span>,</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                           <a class="code" href="group__tcpros__config.html#gabea19b4ccf604094c99a755d1e25dccd" title="TCPROS Client thread priority.">UROS_TCPROS_CLIENT_PRIO</a>);</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  <a class="code" href="group__threading__funcs.html#gaf5bcef4a97d45aeb65b10c8c6d2c3ee0" title="Initializes a thread pool.">urosThreadPoolObjectInit</a>(&amp;stp-&gt;<a class="code" href="struct_uros_node_status.html#a484c6aadfbac1dd852b91889ff048363" title="TCPROS Server worker thread pool.">tcpsvrThdPool</a>, &amp;stp-&gt;<a class="code" href="struct_uros_node_status.html#a00fca9c39c2361cec36057eb07895dee" title="TCPROS Server worker stack pool.">tcpsvrMemPool</a>,</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                           (<a class="code" href="group__base__types.html#ga7f1ff17e59a50f61ce7e3c18fdae5306" title="One-parameter procedure function pointer.">uros_proc_f</a>)<a class="code" href="group__tcpros__funcs.html#ga53416bb911ab68ff7ab4b0931b844514" title="TCPROS Server worker thread.">urosTcpRosServerThread</a>,</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                           <span class="stringliteral">&quot;TcpRosServer&quot;</span>,</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;                           <a class="code" href="group__tcpros__config.html#gaad1b3b9027c73026c97cc8ddcb6b8474" title="TCPROS Server thread priority.">UROS_TCPROS_SERVER_PRIO</a>);</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <a class="code" href="group__threading__funcs.html#gaf5bcef4a97d45aeb65b10c8c6d2c3ee0" title="Initializes a thread pool.">urosThreadPoolObjectInit</a>(&amp;stp-&gt;<a class="code" href="struct_uros_node_status.html#abaff1e66f176ae4f25add66b2c1918c6" title="XMLRPC Slave worker thread pool.">slaveThdPool</a>, &amp;stp-&gt;<a class="code" href="struct_uros_node_status.html#a5811d9a59a6223e9f0f84c7d641855d9" title="XMLRPC Slave worker stack pool.">slaveMemPool</a>,</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                           (<a class="code" href="group__base__types.html#ga7f1ff17e59a50f61ce7e3c18fdae5306" title="One-parameter procedure function pointer.">uros_proc_f</a>)<a class="code" href="group__rpc__slave__funcs.html#gae71dcf7f9749f9f62d33f6dc314dd55e" title="XMLRPC Slave API processing thread.">urosRpcSlaveServerThread</a>,</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                           <span class="stringliteral">&quot;RpcSlaveServer&quot;</span>,</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;                           <a class="code" href="group__rpc__config.html#ga651b00d734089cc2d544ff394effa9c5" title="XMLRPC Slave server thread priority.">UROS_XMLRPC_SLAVE_PRIO</a>);</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;}</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment"> * @brief   Loads the default node configuration.</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment"> * @details Any previously allocated data is freed, then the default node</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment"> *          configuration is loaded.</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment"> * @pre     The related @p UrosNode is initialized.</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment"> * @param[in,out] cfgp</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment"> *          Pointer to the target configuration descriptor.</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00147"></a><span class="lineno"><a class="code" href="group__node__funcs.html#gac78a4ce084b654bf1095a626d20187de">  147</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__node__funcs.html#gac78a4ce084b654bf1095a626d20187de" title="Loads the default node configuration.">urosNodeConfigLoadDefaults</a>(<a class="code" href="struct_uros_node_config.html" title="Node configuration descriptor.">UrosNodeConfig</a> *cfgp) {</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(cfgp != NULL);</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  <span class="comment">/* Deallocate any previously allocated data.*/</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  <a class="code" href="group__base__funcs.html#ga09d885f53087047696beb347b4b9a220" title="Cleans a string object.">urosStringClean</a>(&amp;cfgp-&gt;<a class="code" href="struct_uros_node_config.html#ac2ab2f5d771a355846f4a88bcaf86c39" title="Node name.">nodeName</a>);</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  <a class="code" href="group__base__funcs.html#ga09d885f53087047696beb347b4b9a220" title="Cleans a string object.">urosStringClean</a>(&amp;cfgp-&gt;<a class="code" href="struct_uros_node_config.html#aa741eb4fd467dba559ec3f58293f022e" title="XMLRPC Listener URI.">xmlrpcUri</a>);</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  <a class="code" href="group__base__funcs.html#ga09d885f53087047696beb347b4b9a220" title="Cleans a string object.">urosStringClean</a>(&amp;cfgp-&gt;<a class="code" href="struct_uros_node_config.html#a1b20a2bfd7eab7a4ba3c1a9e41dfbbe8" title="TCPROS Listener URI.">tcprosUri</a>);</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  <a class="code" href="group__base__funcs.html#ga09d885f53087047696beb347b4b9a220" title="Cleans a string object.">urosStringClean</a>(&amp;cfgp-&gt;<a class="code" href="struct_uros_node_config.html#a3f57e67eb0d97b116a195180272b8066" title="ROS Master XMLRPC server URI.">masterUri</a>);</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  <span class="comment">/* Load default values.*/</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  cfgp-&gt;<a class="code" href="struct_uros_node_config.html#ac2ab2f5d771a355846f4a88bcaf86c39" title="Node name.">nodeName</a> = <a class="code" href="group__base__funcs.html#ga20b51d5d62b9561ed898801e9963a517" title="Clones a string object from a null-terminated string.">urosStringCloneZ</a>(<span class="stringliteral">&quot;/turtlesim&quot;</span>);</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  cfgp-&gt;<a class="code" href="struct_uros_node_config.html#a90168222b376ec0176ae49fe4849d5ab" title="XMLRPC Listener address.">xmlrpcAddr</a>.<a class="code" href="struct_uros_addr.html#a14bb7d41100bb1cd35d4a79ea9f44d56" title="Network address (IP).">ip</a>.<a class="code" href="union_uros_ip.html#aa800316c57525c3f7ab7e63806268378" title="Packed dword.">dword</a> = <a class="code" href="group__rpc__config.html#gad1cc09bc78c002ea647d242c4bf17e73" title="Default XMLRPC listener IP address, little-endian dword.">UROS_XMLRPC_LISTENER_IP</a>;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  cfgp-&gt;<a class="code" href="struct_uros_node_config.html#a90168222b376ec0176ae49fe4849d5ab" title="XMLRPC Listener address.">xmlrpcAddr</a>.<a class="code" href="struct_uros_addr.html#a3dc073d966e7e4cb97e7d70d2a5a0240" title="Transport layer port.">port</a> = <a class="code" href="group__rpc__config.html#ga643000d1a4e31787233503c97d7563d3" title="Default XMLRPC listener port.">UROS_XMLRPC_LISTENER_PORT</a>;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  cfgp-&gt;<a class="code" href="struct_uros_node_config.html#aa741eb4fd467dba559ec3f58293f022e" title="XMLRPC Listener URI.">xmlrpcUri</a> = <a class="code" href="group__base__funcs.html#ga20b51d5d62b9561ed898801e9963a517" title="Clones a string object from a null-terminated string.">urosStringCloneZ</a>(</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="stringliteral">&quot;rosrpc://&quot;</span><a class="code" href="group__rpc__config.html#ga2c4e3cd6d76dac022ebee4cb76d66b77" title="Default XMLRPC listener IP address, C string.">UROS_XMLRPC_LISTENER_IP_SZ</a></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="stringliteral">&quot;:&quot;</span><a class="code" href="group__base__macros.html#ga2fb23c12f53d80f2f782edee39833140" title="Pre-processes the value of define as a ROM string.">UROS_STRINGIFY2</a>(<a class="code" href="group__rpc__config.html#ga643000d1a4e31787233503c97d7563d3" title="Default XMLRPC listener port.">UROS_XMLRPC_LISTENER_PORT</a>));</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  cfgp-&gt;<a class="code" href="struct_uros_node_config.html#ab753d63232b5afd9216da455e2ddcd6d" title="TCPROS Listener address.">tcprosAddr</a>.<a class="code" href="struct_uros_addr.html#a14bb7d41100bb1cd35d4a79ea9f44d56" title="Network address (IP).">ip</a>.<a class="code" href="union_uros_ip.html#aa800316c57525c3f7ab7e63806268378" title="Packed dword.">dword</a> = <a class="code" href="group__tcpros__config.html#ga97198d8262c800e4d274ad0fd31cd57a" title="Default TCPROS listener IP address, little-endian dword.">UROS_TCPROS_LISTENER_IP</a>;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  cfgp-&gt;<a class="code" href="struct_uros_node_config.html#ab753d63232b5afd9216da455e2ddcd6d" title="TCPROS Listener address.">tcprosAddr</a>.<a class="code" href="struct_uros_addr.html#a3dc073d966e7e4cb97e7d70d2a5a0240" title="Transport layer port.">port</a> = <a class="code" href="group__tcpros__config.html#gaabefe5e42900de78cc8af129c65055b7" title="Default TCPROS listener port.">UROS_TCPROS_LISTENER_PORT</a>;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  cfgp-&gt;<a class="code" href="struct_uros_node_config.html#a1b20a2bfd7eab7a4ba3c1a9e41dfbbe8" title="TCPROS Listener URI.">tcprosUri</a> = <a class="code" href="group__base__funcs.html#ga20b51d5d62b9561ed898801e9963a517" title="Clones a string object from a null-terminated string.">urosStringCloneZ</a>(</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="stringliteral">&quot;rosrpc://&quot;</span><a class="code" href="group__tcpros__config.html#ga1a67e58b68a7a20f4a8c7773583c2574" title="Default TCPROS listener IP address, C string.">UROS_TCPROS_LISTENER_IP_SZ</a></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="stringliteral">&quot;:&quot;</span><a class="code" href="group__base__macros.html#ga2fb23c12f53d80f2f782edee39833140" title="Pre-processes the value of define as a ROM string.">UROS_STRINGIFY2</a>(<a class="code" href="group__tcpros__config.html#gaabefe5e42900de78cc8af129c65055b7" title="Default TCPROS listener port.">UROS_TCPROS_LISTENER_PORT</a>));</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  cfgp-&gt;<a class="code" href="struct_uros_node_config.html#a433cf14823804cddc8f34870f57f061f" title="ROS Master XMLRPC server address.">masterAddr</a>.<a class="code" href="struct_uros_addr.html#a14bb7d41100bb1cd35d4a79ea9f44d56" title="Network address (IP).">ip</a>.<a class="code" href="union_uros_ip.html#aa800316c57525c3f7ab7e63806268378" title="Packed dword.">dword</a> = <a class="code" href="group__rpc__config.html#ga1de396ee3022e1cf6248e620149537c1" title="Default Master server IP address, little-endian dword.">UROS_XMLRPC_MASTER_IP</a>;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  cfgp-&gt;<a class="code" href="struct_uros_node_config.html#a433cf14823804cddc8f34870f57f061f" title="ROS Master XMLRPC server address.">masterAddr</a>.<a class="code" href="struct_uros_addr.html#a3dc073d966e7e4cb97e7d70d2a5a0240" title="Transport layer port.">port</a> = <a class="code" href="group__rpc__config.html#ga70a795764406bce5f9d20bff152fe676" title="Default Master server port.">UROS_XMLRPC_MASTER_PORT</a>;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  cfgp-&gt;<a class="code" href="struct_uros_node_config.html#a3f57e67eb0d97b116a195180272b8066" title="ROS Master XMLRPC server URI.">masterUri</a> = <a class="code" href="group__base__funcs.html#ga20b51d5d62b9561ed898801e9963a517" title="Clones a string object from a null-terminated string.">urosStringCloneZ</a>(</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="stringliteral">&quot;rosrpc://&quot;</span><a class="code" href="group__rpc__config.html#gaf07833810b75ac295182cc55a095abb9" title="Default Master server IP address, C string.">UROS_XMLRPC_MASTER_IP_SZ</a></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="stringliteral">&quot;:&quot;</span><a class="code" href="group__base__macros.html#ga2fb23c12f53d80f2f782edee39833140" title="Pre-processes the value of define as a ROM string.">UROS_STRINGIFY2</a>(<a class="code" href="group__rpc__config.html#ga70a795764406bce5f9d20bff152fe676" title="Default Master server port.">UROS_XMLRPC_MASTER_PORT</a>));</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;}</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="comment"> * @brief   Loads node configuration.</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="comment"> * @details Any previously allocated data is freed, then the configuration is</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="comment"> *          loaded from a static non-volatile memory chunk.</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="comment"> * @see     uros_lld_nodeconfig_load()</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="comment"> * @pre     The related @p UrosNode is initialized.</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment"> * @param[in,out] cfgp</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="comment"> *          Pointer to the target configuration descriptor.</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00187"></a><span class="lineno"><a class="code" href="group__node__funcs.html#ga8f2c7d165f0aad82b9ee3a45204bfa1b">  187</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__node__funcs.html#ga8f2c7d165f0aad82b9ee3a45204bfa1b" title="Loads node configuration.">urosNodeConfigLoad</a>(<a class="code" href="struct_uros_node_config.html" title="Node configuration descriptor.">UrosNodeConfig</a> *cfgp) {</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  <a class="code" href="group__node__lld__funcs.html#gad3a33ab5be14d00f215f0e21cc3bacb7" title="Loads node configuration.">uros_lld_nodeconfig_load</a>(cfgp);</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;}</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="comment"> * @brief   Saves the node configuration.</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="comment"> * @details The node configuration is saved to a static non-volatile memory</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="comment"> *          chunk.</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="comment"> * @see     uros_lld_nodeconfig_save()</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="comment"> * @pre     The related @p UrosNode is initialized.</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment"> * @param[in] cfgp</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="comment"> *          Pointer to the configuration descriptor to be saved.</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00203"></a><span class="lineno"><a class="code" href="group__node__funcs.html#ga681a0ef014f3a06df3d874155be1a97a">  203</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="group__node__funcs.html#ga681a0ef014f3a06df3d874155be1a97a" title="Saves the node configuration.">urosNodeConfigSave</a>(<span class="keyword">const</span> <a class="code" href="struct_uros_node_config.html" title="Node configuration descriptor.">UrosNodeConfig</a> *cfgp) {</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  <a class="code" href="group__node__lld__funcs.html#ga02de611be8e8a4d16ac9d082c0b3cf12" title="Saves the node configuration.">uros_lld_nodeconfig_save</a>(cfgp);</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;}</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="comment"> * TODO</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00211"></a><span class="lineno"><a class="code" href="group__node__funcs.html#ga7e72bc38a7dc724e2294077972af78cb">  211</a></span>&#160;<a class="code" href="group__base__types.html#gaac94ee32652dcb53686fdf6881996b6c" title="Error codes enumerator.">uros_err_t</a> <a class="code" href="group__node__funcs.html#ga7e72bc38a7dc724e2294077972af78cb">urosNodePublishTopic</a>(<span class="keyword">const</span> <a class="code" href="struct_uros_string.html" title="String object.">UrosString</a> *namep,</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                                <span class="keyword">const</span> <a class="code" href="struct_uros_string.html" title="String object.">UrosString</a> *typep,</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;                                <a class="code" href="group__base__types.html#ga7f1ff17e59a50f61ce7e3c18fdae5306" title="One-parameter procedure function pointer.">uros_proc_f</a> procf) {</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  <a class="code" href="struct_uros_topic.html" title="Topic descriptor.">UrosTopic</a> *topicp;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  <span class="keyword">const</span> <a class="code" href="struct_uros_msg_type.html" title="Message type descriptor.">UrosMsgType</a> *statictypep;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  <a class="code" href="struct_uros_list_node.html" title="List node, forward only.">UrosListNode</a> *topicnodep;</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  <a class="code" href="group__base__types.html#gaac94ee32652dcb53686fdf6881996b6c" title="Error codes enumerator.">uros_err_t</a> err;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(<a class="code" href="group__base__funcs.html#ga683b6cffc3b9aa9d349d61e12a87a7bb" title="Checks if a string is not empty.">urosStringNotEmpty</a>(namep));</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(<a class="code" href="group__base__funcs.html#ga683b6cffc3b9aa9d349d61e12a87a7bb" title="Checks if a string is not empty.">urosStringNotEmpty</a>(typep));</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(procf != NULL);</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  <span class="comment">/* Get the registered message type.*/</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  statictypep = <a class="code" href="group__base__funcs.html#ga55350c72a8397fbdd9b9bc4f7f68735f" title="Gets the message type descriptor with the requested name.">urosFindStaticMsgType</a>(typep);</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  <a class="code" href="group__base__macros.html#gae2617103c16f3e9d923d712289011471" title="Checks if an error occurred, and generates a message.">urosError</a>(statictypep == NULL, <span class="keywordflow">return</span> <a class="code" href="group__base__types.html#ggaac94ee32652dcb53686fdf6881996b6ca19c137733c13835c93db1cc3099c7a83" title="Bad parameter.">UROS_ERR_BADPARAM</a>,</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;            (<span class="stringliteral">&quot;Unknown message type [%.*s]\n&quot;</span>, <a class="code" href="group__base__macros.html#ga0944421111e89ed6889954cb67c58bcd" title="Makes the formatted parameters for an UrosString object.">UROS_STRARG</a>(typep)));</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  <span class="comment">/* Check if the topic already exists.*/</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  <a class="code" href="group__threading__funcs.html#ga1db2c55616b4b1264d778c1ae5f25a83" title="Locks a mutex.">urosMutexLock</a>(&amp;urosNode.<a class="code" href="struct_uros_node.html#a5824c0ae5741fd90f941e81ce22fac13" title="Node status.">status</a>.<a class="code" href="struct_uros_node_status.html#a6e0bf4f06068497a8254ff5b5341d1b5" title="Topic publications lock.">pubTopicListLock</a>);</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  topicnodep = <a class="code" href="group__base__funcs.html#gaf3be0d7e379f41fd664bf2d6356fe84f" title="Gets the list node referencing a topic with the requested name.">urosTopicListFindByName</a>(&amp;urosNode.<a class="code" href="struct_uros_node.html#a5824c0ae5741fd90f941e81ce22fac13" title="Node status.">status</a>.<a class="code" href="struct_uros_node_status.html#a01c083cd0b765e45e9f4615b18b8f681" title="List of topic publications.">pubTopicList</a>, namep);</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  <a class="code" href="group__threading__funcs.html#ga35dba778a18d8708fcf957da4e5110b3" title="Unlocks a mutex.">urosMutexUnlock</a>(&amp;urosNode.<a class="code" href="struct_uros_node.html#a5824c0ae5741fd90f941e81ce22fac13" title="Node status.">status</a>.<a class="code" href="struct_uros_node_status.html#a6e0bf4f06068497a8254ff5b5341d1b5" title="Topic publications lock.">pubTopicListLock</a>);</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  <a class="code" href="group__base__macros.html#gae2617103c16f3e9d923d712289011471" title="Checks if an error occurred, and generates a message.">urosError</a>(topicnodep != NULL, <span class="keywordflow">return</span> UROS_ERR_BADPARAM,</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;            (<span class="stringliteral">&quot;Topic [%.*s] already published\n&quot;</span>, <a class="code" href="group__base__macros.html#ga0944421111e89ed6889954cb67c58bcd" title="Makes the formatted parameters for an UrosString object.">UROS_STRARG</a>(namep)));</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  <span class="comment">/* Create a new topic descriptor.*/</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  topicp = <a class="code" href="group__base__macros.html#gaf5fd0f0a25b126bd46328ab6e956dc2d" title="Allocates a typed object.">urosNew</a>(<a class="code" href="struct_uros_topic.html" title="Topic descriptor.">UrosTopic</a>);</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  <span class="keywordflow">if</span> (topicp == NULL) { <span class="keywordflow">return</span> <a class="code" href="group__base__types.html#ggaac94ee32652dcb53686fdf6881996b6cad6877461eb507108e0b2d8d26608252c" title="Not enough free memory.">UROS_ERR_NOMEM</a>; }</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  <a class="code" href="group__base__funcs.html#gaeed2817c2f87f5f953f48e44f83a2d5a" title="Initializes a topic descriptor.">urosTopicObjectInit</a>(topicp);</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  topicp-&gt;<a class="code" href="struct_uros_topic.html#aeff3ee92d44d0e73582c314410d3d141" title="Topic/Service name.">name</a> = <a class="code" href="group__base__funcs.html#gaa06fbc7230d27fd97612c38c7c40d500" title="Clones a string object.">urosStringClone</a>(namep);</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  topicp-&gt;<a class="code" href="struct_uros_topic.html#a67377ab341821c1906a4b3feac57cb20" title="Topic/Service message type.">typep</a> = statictypep;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  topicp-&gt;<a class="code" href="struct_uros_topic.html#a48e8b6a49c7d892cf19854f00251d24d" title="Procedure handler.">procf</a> = procf;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  <span class="comment">/* Publish the topic.*/</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  err = <a class="code" href="group__node__funcs.html#ga9ca502f6e069b5a99f6f80627bb50ce2" title="Publishes a topic by its descriptor.">urosNodePublishTopicByDesc</a>(topicp);</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  <span class="keywordflow">if</span> (err != <a class="code" href="group__base__types.html#ggaac94ee32652dcb53686fdf6881996b6ca2aa45ad0fcc039cef995b754c97f63ce" title="No errors.">UROS_OK</a>) { <a class="code" href="group__base__funcs.html#ga4d08e89758fa879909cd58df47bf4d94" title="Deallocates a topic descriptor.">urosTopicDelete</a>(topicp); }</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;}</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment"> * TODO</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00253"></a><span class="lineno"><a class="code" href="group__node__funcs.html#gaf385e932c07bf771bf2eb7113cfe2652">  253</a></span>&#160;<a class="code" href="group__base__types.html#gaac94ee32652dcb53686fdf6881996b6c" title="Error codes enumerator.">uros_err_t</a> <a class="code" href="group__node__funcs.html#gaf385e932c07bf771bf2eb7113cfe2652">urosNodePublishTopicSZ</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *namep,</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                                  <span class="keyword">const</span> <span class="keywordtype">char</span> *typep,</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                                  <a class="code" href="group__base__types.html#ga7f1ff17e59a50f61ce7e3c18fdae5306" title="One-parameter procedure function pointer.">uros_proc_f</a> procf) {</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  <a class="code" href="struct_uros_string.html" title="String object.">UrosString</a> namestr, typestr;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(namep != NULL);</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(namep[0] != 0);</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(typep != NULL);</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(typep[0] != 0);</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(procf != NULL);</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  namestr = <a class="code" href="group__base__funcs.html#ga45818844e48c6458a4ab88820a0ef6c1" title="The string object points to a memory chunk.">urosStringAssignZ</a>(namep);</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  typestr = <a class="code" href="group__base__funcs.html#ga45818844e48c6458a4ab88820a0ef6c1" title="The string object points to a memory chunk.">urosStringAssignZ</a>(typep);</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group__node__funcs.html#ga7e72bc38a7dc724e2294077972af78cb">urosNodePublishTopic</a>(&amp;namestr, &amp;typestr, procf);</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;}</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="comment"> * @brief   Publishes a topic by its descriptor.</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="comment"> * @details Issues a @p publishTopic() call to the XMLRPC Master.</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="comment"> * @see     urosRpcCallRegisterPublisher()</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="comment"> * @warning The access to the topic registry is thread-safe, but delays of the</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="comment"> *          XMLRPC communication will delay also any other threads trying to</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="comment"> *          publish/unpublish any topics.</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="comment"> * @pre     The topic is not published.</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="comment"> * @pre     The topic descriptor must have the @p service flag set to @p 0.</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="comment"> * @post    - If successful, the topic descriptor is referenced by the topic</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="comment"> *            registry, and is no longer modifiable by the caller function.</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="comment"> *          - If unsuccessful, the topic descriptor can be deallocated by the</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="comment"> *            caller function.</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="comment"> * @param[in] topicp</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="comment"> *          Pointer to the topic descriptor to be published and registered.</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="comment"> * @return</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="comment"> *          Error code.</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00290"></a><span class="lineno"><a class="code" href="group__node__funcs.html#ga9ca502f6e069b5a99f6f80627bb50ce2">  290</a></span>&#160;<a class="code" href="group__base__types.html#gaac94ee32652dcb53686fdf6881996b6c" title="Error codes enumerator.">uros_err_t</a> <a class="code" href="group__node__funcs.html#ga9ca502f6e069b5a99f6f80627bb50ce2" title="Publishes a topic by its descriptor.">urosNodePublishTopicByDesc</a>(<a class="code" href="struct_uros_topic.html" title="Topic descriptor.">UrosTopic</a> *topicp) {</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="struct_uros_node_config.html" title="Node configuration descriptor.">UrosNodeConfig</a> *cfgp = &amp;urosNode.<a class="code" href="struct_uros_node.html#adc952e6ab7c3a6fa73a3f35f445dce8b" title="Node configuration (loaded at boot time).">config</a>;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  <a class="code" href="struct_uros_rpc_response.html" title="XMLRPC call response object.">UrosRpcResponse</a> response;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  <a class="code" href="group__base__types.html#gaac94ee32652dcb53686fdf6881996b6c" title="Error codes enumerator.">uros_err_t</a> err;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  <a class="code" href="struct_uros_list_node.html" title="List node, forward only.">UrosListNode</a> *nodep;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(topicp != NULL);</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(<a class="code" href="group__base__funcs.html#ga683b6cffc3b9aa9d349d61e12a87a7bb" title="Checks if a string is not empty.">urosStringNotEmpty</a>(&amp;topicp-&gt;<a class="code" href="struct_uros_topic.html#aeff3ee92d44d0e73582c314410d3d141" title="Topic/Service name.">name</a>));</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(topicp-&gt;<a class="code" href="struct_uros_topic.html#a67377ab341821c1906a4b3feac57cb20" title="Topic/Service message type.">typep</a> != NULL);</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(<a class="code" href="group__base__funcs.html#ga683b6cffc3b9aa9d349d61e12a87a7bb" title="Checks if a string is not empty.">urosStringNotEmpty</a>(&amp;topicp-&gt;<a class="code" href="struct_uros_topic.html#a67377ab341821c1906a4b3feac57cb20" title="Topic/Service message type.">typep</a>-&gt;<a class="code" href="struct_uros_msg_type.html#a66908c2943f4d2f1d61e2b7be9ce39fe" title="Type name.">name</a>));</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(topicp-&gt;<a class="code" href="struct_uros_topic.html#a017c55fd0af0b56715c32c64445d09fa" title="Reference counter.">refcnt</a> == 0);</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;  <a class="code" href="group__rpc__funcs.html#ga3aa421f7a9011427fb23add0d0bd80c8" title="Initializes a XMLRPC response.">urosRpcResponseObjectInit</a>(&amp;response);</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  <a class="code" href="group__threading__funcs.html#ga1db2c55616b4b1264d778c1ae5f25a83" title="Locks a mutex.">urosMutexLock</a>(&amp;urosNode.<a class="code" href="struct_uros_node.html#a5824c0ae5741fd90f941e81ce22fac13" title="Node status.">status</a>.<a class="code" href="struct_uros_node_status.html#a6e0bf4f06068497a8254ff5b5341d1b5" title="Topic publications lock.">pubTopicListLock</a>);</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  <span class="comment">/* Master XMLRPC registerPublisher() */</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  err = <a class="code" href="group__rpc__call__funcs.html#ga2aac062d5fc2d53174ac5359823d0bef" title="Register the caller as a publisher the topic.">urosRpcCallRegisterPublisher</a>(</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    &amp;cfgp-&gt;<a class="code" href="struct_uros_node_config.html#a433cf14823804cddc8f34870f57f061f" title="ROS Master XMLRPC server address.">masterAddr</a>,</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    &amp;cfgp-&gt;<a class="code" href="struct_uros_node_config.html#ac2ab2f5d771a355846f4a88bcaf86c39" title="Node name.">nodeName</a>,</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    &amp;topicp-&gt;<a class="code" href="struct_uros_topic.html#aeff3ee92d44d0e73582c314410d3d141" title="Topic/Service name.">name</a>,</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    &amp;topicp-&gt;<a class="code" href="struct_uros_topic.html#a67377ab341821c1906a4b3feac57cb20" title="Topic/Service message type.">typep</a>-&gt;<a class="code" href="struct_uros_msg_type.html#a66908c2943f4d2f1d61e2b7be9ce39fe" title="Type name.">name</a>,</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    &amp;cfgp-&gt;<a class="code" href="struct_uros_node_config.html#aa741eb4fd467dba559ec3f58293f022e" title="XMLRPC Listener URI.">xmlrpcUri</a>,</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    &amp;response</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  );</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  <a class="code" href="group__base__macros.html#gae2617103c16f3e9d923d712289011471" title="Checks if an error occurred, and generates a message.">urosError</a>(err != <a class="code" href="group__base__types.html#ggaac94ee32652dcb53686fdf6881996b6ca2aa45ad0fcc039cef995b754c97f63ce" title="No errors.">UROS_OK</a>, <span class="keywordflow">goto</span> _finally,</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;            (<span class="stringliteral">&quot;Error %s while registering as publisher of topic [%.*s]\n&quot;</span>,</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;             <a class="code" href="group__base__funcs.html#gaffc66585c4773691fb36881ecf8bab2a" title="Text of an error code.">urosErrorText</a>(err), <a class="code" href="group__base__macros.html#ga0944421111e89ed6889954cb67c58bcd" title="Makes the formatted parameters for an UrosString object.">UROS_STRARG</a>(&amp;topicp-&gt;<a class="code" href="struct_uros_topic.html#aeff3ee92d44d0e73582c314410d3d141" title="Topic/Service name.">name</a>)));</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  <span class="comment">/* Check for valid codes.*/</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  <a class="code" href="group__base__macros.html#gae2617103c16f3e9d923d712289011471" title="Checks if an error occurred, and generates a message.">urosError</a>(response.<a class="code" href="struct_uros_rpc_response.html#a2b2df079d5bf428ca349ecac28bba0ad" title="Response code (.">code</a> != <a class="code" href="group__rpc__types.html#gga17b8b6fc0f50d5d51c58ba1e3259487aa1888553c768a7611c981fa59d40e6fd4" title="Method completed successfully.">UROS_RPCC_SUCCESS</a>,</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;            { <span class="keywordflow">return</span> <a class="code" href="group__base__types.html#ggaac94ee32652dcb53686fdf6881996b6ca19c137733c13835c93db1cc3099c7a83" title="Bad parameter.">UROS_ERR_BADPARAM</a>; <span class="keywordflow">goto</span> _finally; },</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;            (<span class="stringliteral">&quot;Response code %d, expected %d\n&quot;</span>,</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;             response.code, <a class="code" href="group__rpc__types.html#gga17b8b6fc0f50d5d51c58ba1e3259487aa1888553c768a7611c981fa59d40e6fd4" title="Method completed successfully.">UROS_RPCC_SUCCESS</a>));</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  <a class="code" href="group__base__macros.html#gae2617103c16f3e9d923d712289011471" title="Checks if an error occurred, and generates a message.">urosError</a>(response.httpcode != 200,</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;            { <span class="keywordflow">return</span> <a class="code" href="group__base__types.html#ggaac94ee32652dcb53686fdf6881996b6ca19c137733c13835c93db1cc3099c7a83" title="Bad parameter.">UROS_ERR_BADPARAM</a>; <span class="keywordflow">goto</span> _finally; },</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;            (<span class="stringliteral">&quot;Response HTTP code %d, expected 200\n&quot;</span>, response.httpcode));</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  <span class="comment">/* Add to the published topics list.*/</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;  nodep = <a class="code" href="group__base__macros.html#gaf5fd0f0a25b126bd46328ab6e956dc2d" title="Allocates a typed object.">urosNew</a>(<a class="code" href="struct_uros_list_node.html" title="List node, forward only.">UrosListNode</a>);</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  <a class="code" href="group__base__funcs.html#ga04cdcbb27dde6c72beb5d31aea330e6b" title="Initializes a list node.">urosListNodeObjectInit</a>(nodep);</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;  nodep-&gt;datap = (<span class="keywordtype">void</span>*)topicp;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;  <a class="code" href="group__base__funcs.html#gae5808c2f0aeb0a570ae545f7468acdce" title="Adds a node to the list.">urosListAdd</a>(&amp;urosNode.<a class="code" href="struct_uros_node.html#a5824c0ae5741fd90f941e81ce22fac13" title="Node status.">status</a>.<a class="code" href="struct_uros_node_status.html#a01c083cd0b765e45e9f4615b18b8f681" title="List of topic publications.">pubTopicList</a>, nodep);</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  err = <a class="code" href="group__base__types.html#ggaac94ee32652dcb53686fdf6881996b6ca2aa45ad0fcc039cef995b754c97f63ce" title="No errors.">UROS_OK</a>;</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;_finally:</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  <span class="comment">/* Cleanup and return.*/</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  <a class="code" href="group__threading__funcs.html#ga35dba778a18d8708fcf957da4e5110b3" title="Unlocks a mutex.">urosMutexUnlock</a>(&amp;urosNode.<a class="code" href="struct_uros_node.html#a5824c0ae5741fd90f941e81ce22fac13" title="Node status.">status</a>.<a class="code" href="struct_uros_node_status.html#a6e0bf4f06068497a8254ff5b5341d1b5" title="Topic publications lock.">pubTopicListLock</a>);</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  <a class="code" href="group__rpc__funcs.html#ga42e2108515c503cc0e89a65c4361b794" title="Cleans a XMLRPC resposnse.">urosRpcResponseClean</a>(&amp;response);</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;}</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="comment"> * @brief   Unpublishes a topic.</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="comment"> * @details Issues an @p unpublishTopic() call to the XMLRPC Master.</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="comment"> * @see     urosRpcCallUnregisterPublisher()</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="comment"> * @warning The access to the topic registry is thread-safe, but delays of the</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="comment"> *          XMLRPC communication will delay also any other threads trying to</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="comment"> *          publish/unpublish any topics.</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="comment"> * @pre     The topic is published.</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="comment"> * @post    If successful, the topic descriptor is dereferenced by the topic</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="comment"> *          registry, and will be freed:</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="comment"> *          - by this function, if there are no publishing TCPROS threads, or</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="comment"> *          - by the last publishing TCPROS thread which references the topic.</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="comment"> * @param[in] namep</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="comment"> *          Pointer to a string which names the topic.</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="comment"> * @return</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="comment"> *          Error code.</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00361"></a><span class="lineno"><a class="code" href="group__node__funcs.html#gafc8f59fe8f65ea0b6a87c9f811f3c7f0">  361</a></span>&#160;<a class="code" href="group__base__types.html#gaac94ee32652dcb53686fdf6881996b6c" title="Error codes enumerator.">uros_err_t</a> <a class="code" href="group__node__funcs.html#gafc8f59fe8f65ea0b6a87c9f811f3c7f0" title="Unpublishes a topic.">urosNodeUnpublishTopic</a>(<span class="keyword">const</span> <a class="code" href="struct_uros_string.html" title="String object.">UrosString</a> *namep) {</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;  <a class="code" href="struct_uros_list_node.html" title="List node, forward only.">UrosListNode</a> *tcprosnodep, *topicnodep;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;  <a class="code" href="struct_uros_topic.html" title="Topic descriptor.">UrosTopic</a> *topicp;</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  <a class="code" href="group__base__types.html#gaac94ee32652dcb53686fdf6881996b6c" title="Error codes enumerator.">uros_err_t</a> err;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  <a class="code" href="struct_uros_rpc_response.html" title="XMLRPC call response object.">UrosRpcResponse</a> res;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(<a class="code" href="group__base__funcs.html#ga683b6cffc3b9aa9d349d61e12a87a7bb" title="Checks if a string is not empty.">urosStringNotEmpty</a>(namep));</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;  <span class="comment">/* Find the topic descriptor.*/</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  <a class="code" href="group__threading__funcs.html#ga1db2c55616b4b1264d778c1ae5f25a83" title="Locks a mutex.">urosMutexLock</a>(&amp;urosNode.<a class="code" href="struct_uros_node.html#a5824c0ae5741fd90f941e81ce22fac13" title="Node status.">status</a>.<a class="code" href="struct_uros_node_status.html#a6e0bf4f06068497a8254ff5b5341d1b5" title="Topic publications lock.">pubTopicListLock</a>);</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  topicnodep = <a class="code" href="group__base__funcs.html#gaf3be0d7e379f41fd664bf2d6356fe84f" title="Gets the list node referencing a topic with the requested name.">urosTopicListFindByName</a>(&amp;urosNode.<a class="code" href="struct_uros_node.html#a5824c0ae5741fd90f941e81ce22fac13" title="Node status.">status</a>.<a class="code" href="struct_uros_node_status.html#a01c083cd0b765e45e9f4615b18b8f681" title="List of topic publications.">pubTopicList</a>, namep);</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  <span class="keywordflow">if</span> (topicnodep == NULL) {</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <a class="code" href="group__base__macros.html#gae2617103c16f3e9d923d712289011471" title="Checks if an error occurred, and generates a message.">urosError</a>(topicnodep == NULL,</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;              { err = <a class="code" href="group__base__types.html#ggaac94ee32652dcb53686fdf6881996b6ca19c137733c13835c93db1cc3099c7a83" title="Bad parameter.">UROS_ERR_BADPARAM</a>; <span class="keywordflow">goto</span> _finally; },</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;              (<span class="stringliteral">&quot;Topic [%.*s] not published\n&quot;</span>, <a class="code" href="group__base__macros.html#ga0944421111e89ed6889954cb67c58bcd" title="Makes the formatted parameters for an UrosString object.">UROS_STRARG</a>(namep)));</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  }</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;  topicp = (<a class="code" href="struct_uros_topic.html" title="Topic descriptor.">UrosTopic</a>*)topicnodep-&gt;<a class="code" href="struct_uros_list_node.html#ab88d07767307bb2312d50abf2e87833b" title="Generic data pointer.">datap</a>;</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  <span class="comment">/* Unregister the topic on the Master node.*/</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;  err = <a class="code" href="group__rpc__call__funcs.html#gab469008e468de0f69cd4d8783fda67a4" title="Unregister the caller as a publisher of the topic.">urosRpcCallUnregisterPublisher</a>(</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    &amp;urosNode.<a class="code" href="struct_uros_node.html#adc952e6ab7c3a6fa73a3f35f445dce8b" title="Node configuration (loaded at boot time).">config</a>.<a class="code" href="struct_uros_node_config.html#a433cf14823804cddc8f34870f57f061f" title="ROS Master XMLRPC server address.">masterAddr</a>,</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    &amp;urosNode.<a class="code" href="struct_uros_node.html#adc952e6ab7c3a6fa73a3f35f445dce8b" title="Node configuration (loaded at boot time).">config</a>.<a class="code" href="struct_uros_node_config.html#ac2ab2f5d771a355846f4a88bcaf86c39" title="Node name.">nodeName</a>,</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    namep,</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    &amp;urosNode.<a class="code" href="struct_uros_node.html#adc952e6ab7c3a6fa73a3f35f445dce8b" title="Node configuration (loaded at boot time).">config</a>.<a class="code" href="struct_uros_node_config.html#aa741eb4fd467dba559ec3f58293f022e" title="XMLRPC Listener URI.">xmlrpcUri</a>,</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    &amp;res</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;  );</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;  <a class="code" href="group__base__macros.html#gae2617103c16f3e9d923d712289011471" title="Checks if an error occurred, and generates a message.">urosError</a>(err != <a class="code" href="group__base__types.html#ggaac94ee32652dcb53686fdf6881996b6ca2aa45ad0fcc039cef995b754c97f63ce" title="No errors.">UROS_OK</a>, <a class="code" href="group__base__macros.html#ga159478ffa2ebe6a29bda7446baa7c44a" title="No operation placeholder.">UROS_NOP</a>,</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;            (<span class="stringliteral">&quot;Error %s while unregistering as publisher of topic [%.*s]\n&quot;</span>,</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;             <a class="code" href="group__base__funcs.html#gaffc66585c4773691fb36881ecf8bab2a" title="Text of an error code.">urosErrorText</a>(err), <a class="code" href="group__base__macros.html#ga0944421111e89ed6889954cb67c58bcd" title="Makes the formatted parameters for an UrosString object.">UROS_STRARG</a>(namep)));</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  <span class="comment">/* Unregister the topic locally.*/</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  topicp-&gt;<a class="code" href="struct_uros_topic.html#a3730873d8d9cb05efed9343c53fc1f57" title="Topic/Service flags.">flags</a>.<a class="code" href="structuros__topicflags__t.html#aa7325cf4481f1dee71ba9fe3ff8407ed" title="Deleted topic descriptor, free asap.">deleted</a> = <a class="code" href="group__base__macros.html#gafe1e9e4dd81f26e3eeaca59d8416142e" title="true boolean value.">UROS_TRUE</a>;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;  tcprosnodep = <a class="code" href="group__base__funcs.html#ga778761e65942c459b0b3be5049686d0a" title="Removes a node from the list.">urosListRemove</a>(&amp;urosNode.<a class="code" href="struct_uros_node.html#a5824c0ae5741fd90f941e81ce22fac13" title="Node status.">status</a>.<a class="code" href="struct_uros_node_status.html#a01c083cd0b765e45e9f4615b18b8f681" title="List of topic publications.">pubTopicList</a>, topicnodep);</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(tcprosnodep == topicnodep);</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  <a class="code" href="group__threading__funcs.html#ga1db2c55616b4b1264d778c1ae5f25a83" title="Locks a mutex.">urosMutexLock</a>(&amp;urosNode.<a class="code" href="struct_uros_node.html#a5824c0ae5741fd90f941e81ce22fac13" title="Node status.">status</a>.<a class="code" href="struct_uros_node_status.html#aaccf2d5947dbe2c31b727e0f8a7a775e" title="Published connections lock.">pubTcpListLock</a>);</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;  <span class="keywordflow">if</span> (urosNode.<a class="code" href="struct_uros_node.html#a5824c0ae5741fd90f941e81ce22fac13" title="Node status.">status</a>.<a class="code" href="struct_uros_node_status.html#a44033dba5661df70b4a8cc19114e57ff" title="Published TCPROS connections.">pubTcpList</a>.<a class="code" href="struct_uros_list.html#a31c61743c1dd1819ae424243ea460558" title="Number of list entries.">length</a> &gt; 0) {</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <span class="comment">/* Tell each publishing TCPROS thread to exit.*/</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <span class="keywordflow">for</span> (tcprosnodep = urosNode.<a class="code" href="struct_uros_node.html#a5824c0ae5741fd90f941e81ce22fac13" title="Node status.">status</a>.<a class="code" href="struct_uros_node_status.html#a44033dba5661df70b4a8cc19114e57ff" title="Published TCPROS connections.">pubTcpList</a>.<a class="code" href="struct_uros_list.html#a94a11e13479a04d2887443d8c55a572b" title="Pointer to the list head node.">headp</a>;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;         tcprosnodep != NULL;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;         tcprosnodep = tcprosnodep-&gt;<a class="code" href="struct_uros_list_node.html#aa3109ac041ab790fe3e4d4bfa36d3465" title="Pointer to the next list entry node.">nextp</a>) {</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;      <a class="code" href="struct_uros_tcp_ros_status.html" title="TCPROS connection status object.">UrosTcpRosStatus</a> *tcpstp = (<a class="code" href="struct_uros_tcp_ros_status.html" title="TCPROS connection status object.">UrosTcpRosStatus</a>*)tcprosnodep-&gt;<a class="code" href="struct_uros_list_node.html#ab88d07767307bb2312d50abf2e87833b" title="Generic data pointer.">datap</a>;</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;      if (tcpstp-&gt;<a class="code" href="struct_uros_tcp_ros_status.html#afc1b0399b8b6dc23c58672813889a1b4" title="Referenced topic/service.">topicp</a> == topicp &amp;&amp; !tcpstp-&gt;<a class="code" href="struct_uros_tcp_ros_status.html#ad2ef0a50c4176a846aaf6898b30d6d3f" title="Topic/Service flags.">flags</a>.<a class="code" href="structuros__topicflags__t.html#a7cfab42a7b27fac28fae7b6f69d4ae73" title="Service/!TcpStatus connection.">service</a>) {</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;        <a class="code" href="group__threading__funcs.html#ga1db2c55616b4b1264d778c1ae5f25a83" title="Locks a mutex.">urosMutexLock</a>(&amp;tcpstp-&gt;<a class="code" href="struct_uros_tcp_ros_status.html#a4ca5f3fd7d69271a17d6f464e0dc33d1" title="Thread exit request mutex.">threadExitMtx</a>);</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        tcpstp-&gt;<a class="code" href="struct_uros_tcp_ros_status.html#a972798677a09c11fcd646e73fe5abc86" title="Thread exit request.">threadExit</a> = <a class="code" href="group__base__macros.html#gafe1e9e4dd81f26e3eeaca59d8416142e" title="true boolean value.">UROS_TRUE</a>;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;        <a class="code" href="group__threading__funcs.html#ga35dba778a18d8708fcf957da4e5110b3" title="Unlocks a mutex.">urosMutexUnlock</a>(&amp;tcpstp-&gt;<a class="code" href="struct_uros_tcp_ros_status.html#a4ca5f3fd7d69271a17d6f464e0dc33d1" title="Thread exit request mutex.">threadExitMtx</a>);</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;      }</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    }</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <span class="comment">/* NOTE: The last exiting thread freeds the topic descriptor.*/</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    <span class="comment">/* No TCPROS connections, just free the descriptor immediately.*/</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <a class="code" href="group__base__funcs.html#ga16bb69f7a4f4c18940a3680a41a62f37" title="Deallocates a list node.">urosListNodeDelete</a>(topicnodep, (<a class="code" href="group__base__types.html#ga3f6900a333ee4b24db9b520c7e55abc8" title="Deletion procedure.">uros_delete_f</a>)<a class="code" href="group__base__funcs.html#ga4d08e89758fa879909cd58df47bf4d94" title="Deallocates a topic descriptor.">urosTopicDelete</a>);</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  }</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;_finally:</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;  <a class="code" href="group__threading__funcs.html#ga35dba778a18d8708fcf957da4e5110b3" title="Unlocks a mutex.">urosMutexUnlock</a>(&amp;urosNode.<a class="code" href="struct_uros_node.html#a5824c0ae5741fd90f941e81ce22fac13" title="Node status.">status</a>.<a class="code" href="struct_uros_node_status.html#a6e0bf4f06068497a8254ff5b5341d1b5" title="Topic publications lock.">pubTopicListLock</a>);</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;  <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;}</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="comment"> * TODO</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00425"></a><span class="lineno"><a class="code" href="group__node__funcs.html#ga28263c8607d14c52bb11450febe0624c">  425</a></span>&#160;<a class="code" href="group__base__types.html#gaac94ee32652dcb53686fdf6881996b6c" title="Error codes enumerator.">uros_err_t</a> <a class="code" href="group__node__funcs.html#ga28263c8607d14c52bb11450febe0624c">urosNodeSubscribeTopic</a>(<span class="keyword">const</span> <a class="code" href="struct_uros_string.html" title="String object.">UrosString</a> *namep,</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;                                  <span class="keyword">const</span> <a class="code" href="struct_uros_string.html" title="String object.">UrosString</a> *typep,</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;                                  <a class="code" href="group__base__types.html#ga7f1ff17e59a50f61ce7e3c18fdae5306" title="One-parameter procedure function pointer.">uros_proc_f</a> procf) {</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  <a class="code" href="struct_uros_topic.html" title="Topic descriptor.">UrosTopic</a> *topicp;</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  <span class="keyword">const</span> <a class="code" href="struct_uros_msg_type.html" title="Message type descriptor.">UrosMsgType</a> *statictypep;</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;  <a class="code" href="struct_uros_list_node.html" title="List node, forward only.">UrosListNode</a> *topicnodep;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;  <a class="code" href="group__base__types.html#gaac94ee32652dcb53686fdf6881996b6c" title="Error codes enumerator.">uros_err_t</a> err;</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(<a class="code" href="group__base__funcs.html#ga683b6cffc3b9aa9d349d61e12a87a7bb" title="Checks if a string is not empty.">urosStringNotEmpty</a>(namep));</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(<a class="code" href="group__base__funcs.html#ga683b6cffc3b9aa9d349d61e12a87a7bb" title="Checks if a string is not empty.">urosStringNotEmpty</a>(typep));</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(procf != NULL);</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;  <span class="comment">/* Get the registered message type.*/</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;  statictypep = <a class="code" href="group__base__funcs.html#ga55350c72a8397fbdd9b9bc4f7f68735f" title="Gets the message type descriptor with the requested name.">urosFindStaticMsgType</a>(typep);</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;  <a class="code" href="group__base__macros.html#gae2617103c16f3e9d923d712289011471" title="Checks if an error occurred, and generates a message.">urosError</a>(statictypep == NULL, <span class="keywordflow">return</span> <a class="code" href="group__base__types.html#ggaac94ee32652dcb53686fdf6881996b6ca19c137733c13835c93db1cc3099c7a83" title="Bad parameter.">UROS_ERR_BADPARAM</a>,</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;            (<span class="stringliteral">&quot;Unknown message type [%.*s]\n&quot;</span>, <a class="code" href="group__base__macros.html#ga0944421111e89ed6889954cb67c58bcd" title="Makes the formatted parameters for an UrosString object.">UROS_STRARG</a>(typep)));</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;  <span class="comment">/* Check if the topic already exists.*/</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;  <a class="code" href="group__threading__funcs.html#ga1db2c55616b4b1264d778c1ae5f25a83" title="Locks a mutex.">urosMutexLock</a>(&amp;urosNode.<a class="code" href="struct_uros_node.html#a5824c0ae5741fd90f941e81ce22fac13" title="Node status.">status</a>.<a class="code" href="struct_uros_node_status.html#afe2468e629b5497699cdd79b3e134f95" title="Topic subscriptions lock.">subTopicListLock</a>);</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;  topicnodep = <a class="code" href="group__base__funcs.html#gaf3be0d7e379f41fd664bf2d6356fe84f" title="Gets the list node referencing a topic with the requested name.">urosTopicListFindByName</a>(&amp;urosNode.<a class="code" href="struct_uros_node.html#a5824c0ae5741fd90f941e81ce22fac13" title="Node status.">status</a>.<a class="code" href="struct_uros_node_status.html#ac1b16540d46ba17899d6a1d715ec8ffd" title="List of topic subscriptions.">subTopicList</a>, namep);</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  <a class="code" href="group__threading__funcs.html#ga35dba778a18d8708fcf957da4e5110b3" title="Unlocks a mutex.">urosMutexUnlock</a>(&amp;urosNode.<a class="code" href="struct_uros_node.html#a5824c0ae5741fd90f941e81ce22fac13" title="Node status.">status</a>.<a class="code" href="struct_uros_node_status.html#afe2468e629b5497699cdd79b3e134f95" title="Topic subscriptions lock.">subTopicListLock</a>);</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;  <a class="code" href="group__base__macros.html#gae2617103c16f3e9d923d712289011471" title="Checks if an error occurred, and generates a message.">urosError</a>(topicnodep != NULL, <span class="keywordflow">return</span> UROS_ERR_BADPARAM,</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;            (<span class="stringliteral">&quot;Topic [%.*s] already subscribed\n&quot;</span>, <a class="code" href="group__base__macros.html#ga0944421111e89ed6889954cb67c58bcd" title="Makes the formatted parameters for an UrosString object.">UROS_STRARG</a>(namep)));</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;  <span class="comment">/* Create a new topic descriptor.*/</span></div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;  topicp = <a class="code" href="group__base__macros.html#gaf5fd0f0a25b126bd46328ab6e956dc2d" title="Allocates a typed object.">urosNew</a>(<a class="code" href="struct_uros_topic.html" title="Topic descriptor.">UrosTopic</a>);</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;  <span class="keywordflow">if</span> (topicp == NULL) { <span class="keywordflow">return</span> <a class="code" href="group__base__types.html#ggaac94ee32652dcb53686fdf6881996b6cad6877461eb507108e0b2d8d26608252c" title="Not enough free memory.">UROS_ERR_NOMEM</a>; }</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;  <a class="code" href="group__base__funcs.html#gaeed2817c2f87f5f953f48e44f83a2d5a" title="Initializes a topic descriptor.">urosTopicObjectInit</a>(topicp);</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;  topicp-&gt;<a class="code" href="struct_uros_topic.html#aeff3ee92d44d0e73582c314410d3d141" title="Topic/Service name.">name</a> = <a class="code" href="group__base__funcs.html#gaa06fbc7230d27fd97612c38c7c40d500" title="Clones a string object.">urosStringClone</a>(namep);</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;  topicp-&gt;<a class="code" href="struct_uros_topic.html#a67377ab341821c1906a4b3feac57cb20" title="Topic/Service message type.">typep</a> = statictypep;</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  topicp-&gt;<a class="code" href="struct_uros_topic.html#a48e8b6a49c7d892cf19854f00251d24d" title="Procedure handler.">procf</a> = procf;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;  <span class="comment">/* Subscribe to the topic.*/</span></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  err = <a class="code" href="group__node__funcs.html#ga9a15140cb500fbbcf29fce16ad31a573" title="Subscribes to a topic by its descriptor.">urosNodeSubscribeTopicByDesc</a>(topicp);</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  <span class="keywordflow">if</span> (err != <a class="code" href="group__base__types.html#ggaac94ee32652dcb53686fdf6881996b6ca2aa45ad0fcc039cef995b754c97f63ce" title="No errors.">UROS_OK</a>) { <a class="code" href="group__base__funcs.html#ga4d08e89758fa879909cd58df47bf4d94" title="Deallocates a topic descriptor.">urosTopicDelete</a>(topicp); }</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;  <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;}</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="comment"> * TODO</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00467"></a><span class="lineno"><a class="code" href="group__node__funcs.html#ga8d0fb7efa4bcddddf554a4d4d58f0b06">  467</a></span>&#160;<a class="code" href="group__base__types.html#gaac94ee32652dcb53686fdf6881996b6c" title="Error codes enumerator.">uros_err_t</a> <a class="code" href="group__node__funcs.html#ga8d0fb7efa4bcddddf554a4d4d58f0b06">urosNodeSubscribeTopicSZ</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *namep,</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;                                    <span class="keyword">const</span> <span class="keywordtype">char</span> *typep,</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;                                    <a class="code" href="group__base__types.html#ga7f1ff17e59a50f61ce7e3c18fdae5306" title="One-parameter procedure function pointer.">uros_proc_f</a> procf) {</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  <a class="code" href="struct_uros_string.html" title="String object.">UrosString</a> namestr, typestr;</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(namep != NULL);</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(namep[0] != 0);</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(typep != NULL);</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(typep[0] != 0);</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(procf != NULL);</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;  namestr = <a class="code" href="group__base__funcs.html#ga45818844e48c6458a4ab88820a0ef6c1" title="The string object points to a memory chunk.">urosStringAssignZ</a>(namep);</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  typestr = <a class="code" href="group__base__funcs.html#ga45818844e48c6458a4ab88820a0ef6c1" title="The string object points to a memory chunk.">urosStringAssignZ</a>(typep);</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group__node__funcs.html#ga28263c8607d14c52bb11450febe0624c">urosNodeSubscribeTopic</a>(&amp;namestr, &amp;typestr, procf);</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;}</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;<span class="comment"> * @brief   Subscribes to a topic by its descriptor.</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;<span class="comment"> * @details Issues a @p registerSubscriber() call to the XMLRPC Master, and</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;<span class="comment"> *          connects to known publishers.</span></div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;<span class="comment"> * @see     urosRpcCallRegisterSubscriber()</span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;<span class="comment"> * @see     urosNodeFindNewPublishers()</span></div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="comment"> * @see     urosRpcSlaveConnectToPublishers()</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;<span class="comment"> * @warning The access to the topic registry is thread-safe, but delays of the</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;<span class="comment"> *          XMLRPC communication will delay also any other threads trying to</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;<span class="comment"> *          subscribe/unsubscribe to any topics.</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;<span class="comment"> * @pre     The topic is not subscribed.</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;<span class="comment"> * @pre     The topic descriptor must have the @p service flag set to @p 0.</span></div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;<span class="comment"> * @post    - If successful, the topic descriptor is referenced by the topic</span></div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;<span class="comment"> *            registry, and is no longer modifiable by the caller function.</span></div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;<span class="comment"> *          - If unsuccessful, the topic descriptor can be deallocated by the</span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;<span class="comment"> *            caller function.</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;<span class="comment"> * @post    Connects to known publishers listed by a successful response.</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;<span class="comment"> * @param[in] topicp</span></div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;<span class="comment"> *          Pointer to the topic descriptor to be subscribed to and registered.</span></div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="comment"> * @return</span></div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;<span class="comment"> *          Error code.</span></div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00508"></a><span class="lineno"><a class="code" href="group__node__funcs.html#ga9a15140cb500fbbcf29fce16ad31a573">  508</a></span>&#160;<a class="code" href="group__base__types.html#gaac94ee32652dcb53686fdf6881996b6c" title="Error codes enumerator.">uros_err_t</a> <a class="code" href="group__node__funcs.html#ga9a15140cb500fbbcf29fce16ad31a573" title="Subscribes to a topic by its descriptor.">urosNodeSubscribeTopicByDesc</a>(<a class="code" href="struct_uros_topic.html" title="Topic descriptor.">UrosTopic</a> *topicp) {</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="struct_uros_node_config.html" title="Node configuration descriptor.">UrosNodeConfig</a> *cfgp = &amp;urosNode.<a class="code" href="struct_uros_node.html#adc952e6ab7c3a6fa73a3f35f445dce8b" title="Node configuration (loaded at boot time).">config</a>;</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;  <a class="code" href="struct_uros_rpc_response.html" title="XMLRPC call response object.">UrosRpcResponse</a> response;</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;  <a class="code" href="group__base__types.html#gaac94ee32652dcb53686fdf6881996b6c" title="Error codes enumerator.">uros_err_t</a> err;</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;  <a class="code" href="struct_uros_list.html" title="Linked list, forward only.">UrosList</a> newpubs;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;  <a class="code" href="struct_uros_list_node.html" title="List node, forward only.">UrosListNode</a> *nodep;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(topicp != NULL);</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(<a class="code" href="group__base__funcs.html#ga683b6cffc3b9aa9d349d61e12a87a7bb" title="Checks if a string is not empty.">urosStringNotEmpty</a>(&amp;topicp-&gt;<a class="code" href="struct_uros_topic.html#aeff3ee92d44d0e73582c314410d3d141" title="Topic/Service name.">name</a>));</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(topicp-&gt;<a class="code" href="struct_uros_topic.html#a67377ab341821c1906a4b3feac57cb20" title="Topic/Service message type.">typep</a> != NULL);</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(<a class="code" href="group__base__funcs.html#ga683b6cffc3b9aa9d349d61e12a87a7bb" title="Checks if a string is not empty.">urosStringNotEmpty</a>(&amp;topicp-&gt;<a class="code" href="struct_uros_topic.html#a67377ab341821c1906a4b3feac57cb20" title="Topic/Service message type.">typep</a>-&gt;<a class="code" href="struct_uros_msg_type.html#a66908c2943f4d2f1d61e2b7be9ce39fe" title="Type name.">name</a>));</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(topicp-&gt;<a class="code" href="struct_uros_topic.html#a017c55fd0af0b56715c32c64445d09fa" title="Reference counter.">refcnt</a> == 0);</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;  <a class="code" href="group__rpc__funcs.html#ga3aa421f7a9011427fb23add0d0bd80c8" title="Initializes a XMLRPC response.">urosRpcResponseObjectInit</a>(&amp;response);</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  <a class="code" href="group__base__funcs.html#ga44e0ce54ba23fc5f0d5d505356867837" title="Initializes a list object.">urosListObjectInit</a>(&amp;newpubs);</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;  <a class="code" href="group__threading__funcs.html#ga1db2c55616b4b1264d778c1ae5f25a83" title="Locks a mutex.">urosMutexLock</a>(&amp;urosNode.<a class="code" href="struct_uros_node.html#a5824c0ae5741fd90f941e81ce22fac13" title="Node status.">status</a>.<a class="code" href="struct_uros_node_status.html#afe2468e629b5497699cdd79b3e134f95" title="Topic subscriptions lock.">subTopicListLock</a>);</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;  <span class="comment">/* Master XMLRPC registerSubscriber() */</span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;  err = <a class="code" href="group__rpc__call__funcs.html#ga93410883896c1317de511a964973da19" title="Subscribe the caller to the specified topic.">urosRpcCallRegisterSubscriber</a>(</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    &amp;cfgp-&gt;<a class="code" href="struct_uros_node_config.html#a433cf14823804cddc8f34870f57f061f" title="ROS Master XMLRPC server address.">masterAddr</a>,</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    &amp;cfgp-&gt;<a class="code" href="struct_uros_node_config.html#ac2ab2f5d771a355846f4a88bcaf86c39" title="Node name.">nodeName</a>,</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    &amp;topicp-&gt;<a class="code" href="struct_uros_topic.html#aeff3ee92d44d0e73582c314410d3d141" title="Topic/Service name.">name</a>,</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    &amp;topicp-&gt;<a class="code" href="struct_uros_topic.html#a67377ab341821c1906a4b3feac57cb20" title="Topic/Service message type.">typep</a>-&gt;<a class="code" href="struct_uros_msg_type.html#a66908c2943f4d2f1d61e2b7be9ce39fe" title="Type name.">name</a>,</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    &amp;cfgp-&gt;<a class="code" href="struct_uros_node_config.html#aa741eb4fd467dba559ec3f58293f022e" title="XMLRPC Listener URI.">xmlrpcUri</a>,</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    &amp;response</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;  );</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;  <a class="code" href="group__base__macros.html#gae2617103c16f3e9d923d712289011471" title="Checks if an error occurred, and generates a message.">urosError</a>(err != <a class="code" href="group__base__types.html#ggaac94ee32652dcb53686fdf6881996b6ca2aa45ad0fcc039cef995b754c97f63ce" title="No errors.">UROS_OK</a>, <span class="keywordflow">goto</span> _finally,</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;            (<span class="stringliteral">&quot;Cannot register as subscriber of topic [%.*s]\n&quot;</span>,</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;             <a class="code" href="group__base__macros.html#ga0944421111e89ed6889954cb67c58bcd" title="Makes the formatted parameters for an UrosString object.">UROS_STRARG</a>(&amp;topicp-&gt;<a class="code" href="struct_uros_topic.html#aeff3ee92d44d0e73582c314410d3d141" title="Topic/Service name.">name</a>)));</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;  <span class="comment">/* Check for valid codes.*/</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;  <a class="code" href="group__base__macros.html#gae2617103c16f3e9d923d712289011471" title="Checks if an error occurred, and generates a message.">urosError</a>(response.<a class="code" href="struct_uros_rpc_response.html#a2b2df079d5bf428ca349ecac28bba0ad" title="Response code (.">code</a> != <a class="code" href="group__rpc__types.html#gga17b8b6fc0f50d5d51c58ba1e3259487aa1888553c768a7611c981fa59d40e6fd4" title="Method completed successfully.">UROS_RPCC_SUCCESS</a>,</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;            { <span class="keywordflow">return</span> <a class="code" href="group__base__types.html#ggaac94ee32652dcb53686fdf6881996b6ca19c137733c13835c93db1cc3099c7a83" title="Bad parameter.">UROS_ERR_BADPARAM</a>; <span class="keywordflow">goto</span> _finally; },</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;            (<span class="stringliteral">&quot;Response code %d, expected %d\n&quot;</span>,</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;             response.code, <a class="code" href="group__rpc__types.html#gga17b8b6fc0f50d5d51c58ba1e3259487aa1888553c768a7611c981fa59d40e6fd4" title="Method completed successfully.">UROS_RPCC_SUCCESS</a>));</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;  <a class="code" href="group__base__macros.html#gae2617103c16f3e9d923d712289011471" title="Checks if an error occurred, and generates a message.">urosError</a>(response.httpcode != 200,</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;            { <span class="keywordflow">return</span> <a class="code" href="group__base__types.html#ggaac94ee32652dcb53686fdf6881996b6ca19c137733c13835c93db1cc3099c7a83" title="Bad parameter.">UROS_ERR_BADPARAM</a>; <span class="keywordflow">goto</span> _finally; },</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;            (<span class="stringliteral">&quot;Response HTTP code %d, expected 200\n&quot;</span>, response.httpcode));</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;  <span class="comment">/* Connect to registered publishers.*/</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;  err = <a class="code" href="group__node__funcs.html#ga289dbcb25897f91da1a881f63c75f190" title="Find new publishers for a given topic.">urosNodeFindNewPublishers</a>(&amp;topicp-&gt;name, response.valuep, &amp;newpubs);</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;  <a class="code" href="group__base__macros.html#gae2617103c16f3e9d923d712289011471" title="Checks if an error occurred, and generates a message.">urosError</a>(err != <a class="code" href="group__base__types.html#ggaac94ee32652dcb53686fdf6881996b6ca2aa45ad0fcc039cef995b754c97f63ce" title="No errors.">UROS_OK</a>, <span class="keywordflow">goto</span> _finally,</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;            (<span class="stringliteral">&quot;Error %s while finding new publishers of topic [%.*s]\n&quot;</span>,</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;             <a class="code" href="group__base__funcs.html#gaffc66585c4773691fb36881ecf8bab2a" title="Text of an error code.">urosErrorText</a>(err), <a class="code" href="group__base__macros.html#ga0944421111e89ed6889954cb67c58bcd" title="Makes the formatted parameters for an UrosString object.">UROS_STRARG</a>(&amp;topicp-&gt;name)));</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;  <a class="code" href="group__rpc__funcs.html#ga42e2108515c503cc0e89a65c4361b794" title="Cleans a XMLRPC resposnse.">urosRpcResponseClean</a>(&amp;response);</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;  err = <a class="code" href="group__rpc__slave__funcs.html#gab2d8688e2c24c7856981c3762cb1c1a3" title="Connects to a list of publishers.">urosRpcSlaveConnectToPublishers</a>(&amp;topicp-&gt;name, &amp;newpubs);</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;  <a class="code" href="group__base__macros.html#gae2617103c16f3e9d923d712289011471" title="Checks if an error occurred, and generates a message.">urosError</a>(err != <a class="code" href="group__base__types.html#ggaac94ee32652dcb53686fdf6881996b6ca2aa45ad0fcc039cef995b754c97f63ce" title="No errors.">UROS_OK</a>, <span class="keywordflow">goto</span> _finally,</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;            (<span class="stringliteral">&quot;Error %s while connecting to new publishers of topic [%.*s]\n&quot;</span>,</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;             <a class="code" href="group__base__funcs.html#gaffc66585c4773691fb36881ecf8bab2a" title="Text of an error code.">urosErrorText</a>(err), <a class="code" href="group__base__macros.html#ga0944421111e89ed6889954cb67c58bcd" title="Makes the formatted parameters for an UrosString object.">UROS_STRARG</a>(&amp;topicp-&gt;name)));</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;  <span class="comment">/* Add to the subscribed topics list.*/</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;  nodep = <a class="code" href="group__base__macros.html#gaf5fd0f0a25b126bd46328ab6e956dc2d" title="Allocates a typed object.">urosNew</a>(<a class="code" href="struct_uros_list_node.html" title="List node, forward only.">UrosListNode</a>);</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;  <a class="code" href="group__base__funcs.html#ga04cdcbb27dde6c72beb5d31aea330e6b" title="Initializes a list node.">urosListNodeObjectInit</a>(nodep);</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;  nodep-&gt;datap = (<span class="keywordtype">void</span>*)topicp;</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;  <a class="code" href="group__base__funcs.html#gae5808c2f0aeb0a570ae545f7468acdce" title="Adds a node to the list.">urosListAdd</a>(&amp;urosNode.<a class="code" href="struct_uros_node.html#a5824c0ae5741fd90f941e81ce22fac13" title="Node status.">status</a>.<a class="code" href="struct_uros_node_status.html#ac1b16540d46ba17899d6a1d715ec8ffd" title="List of topic subscriptions.">subTopicList</a>, nodep);</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;  err = <a class="code" href="group__base__types.html#ggaac94ee32652dcb53686fdf6881996b6ca2aa45ad0fcc039cef995b754c97f63ce" title="No errors.">UROS_OK</a>;</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;_finally:</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;  <span class="comment">/* Cleanup and return.*/</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;  <a class="code" href="group__threading__funcs.html#ga35dba778a18d8708fcf957da4e5110b3" title="Unlocks a mutex.">urosMutexUnlock</a>(&amp;urosNode.<a class="code" href="struct_uros_node.html#a5824c0ae5741fd90f941e81ce22fac13" title="Node status.">status</a>.<a class="code" href="struct_uros_node_status.html#afe2468e629b5497699cdd79b3e134f95" title="Topic subscriptions lock.">subTopicListLock</a>);</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;  <a class="code" href="group__base__funcs.html#ga7467dba1ce6d13c799cb038ac9b761fe" title="Cleans a list.">urosListClean</a>(&amp;newpubs, (<a class="code" href="group__base__types.html#ga3f6900a333ee4b24db9b520c7e55abc8" title="Deletion procedure.">uros_delete_f</a>)<a class="code" href="group__base__funcs.html#gabf008f1631293a018e1d7be3ffbb5b51" title="Deallocates a memory block.">urosFree</a>);</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;  <a class="code" href="group__rpc__funcs.html#ga42e2108515c503cc0e89a65c4361b794" title="Cleans a XMLRPC resposnse.">urosRpcResponseClean</a>(&amp;response);</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;  <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;}</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;<span class="comment"> * @brief   Unsubscribes to a topic.</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;<span class="comment"> * @details Issues an @p unregisterSubscriber() call to the XMLRPC Master.</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;<span class="comment"> * @see     urosRpcCallUnregisterSubscriber()</span></div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="comment"> * @warning The access to the topic registry is thread-safe, but delays of the</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;<span class="comment"> *          XMLRPC communication will delay also any other threads trying to</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;<span class="comment"> *          publish/unpublish any topics.</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="comment"> * @pre     The topic is published.</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;<span class="comment"> * @post    If successful, the topic descriptor is dereferenced by the topic</span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;<span class="comment"> *          registry, and will be freed:</span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;<span class="comment"> *          - by this function, if there are no subscribing TCPROS threads, or</span></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;<span class="comment"> *          - by the last subscribing TCPROS thread which references the topic.</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;<span class="comment"> * @param[in] namep</span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;<span class="comment"> *          Pointer to a string which names the topic.</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;<span class="comment"> * @return</span></div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;<span class="comment"> *          Error code.</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00593"></a><span class="lineno"><a class="code" href="group__node__funcs.html#ga17900ea2127b5e185605b1dc0aa2ad8c">  593</a></span>&#160;<a class="code" href="group__base__types.html#gaac94ee32652dcb53686fdf6881996b6c" title="Error codes enumerator.">uros_err_t</a> <a class="code" href="group__node__funcs.html#ga17900ea2127b5e185605b1dc0aa2ad8c" title="Unsubscribes to a topic.">urosNodeUnsubscribeTopic</a>(<span class="keyword">const</span> <a class="code" href="struct_uros_string.html" title="String object.">UrosString</a> *namep) {</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;  <a class="code" href="struct_uros_list_node.html" title="List node, forward only.">UrosListNode</a> *tcprosnodep, *topicnodep;</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;  <a class="code" href="struct_uros_topic.html" title="Topic descriptor.">UrosTopic</a> *topicp;</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;  <a class="code" href="group__base__types.html#gaac94ee32652dcb53686fdf6881996b6c" title="Error codes enumerator.">uros_err_t</a> err;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;  <a class="code" href="struct_uros_rpc_response.html" title="XMLRPC call response object.">UrosRpcResponse</a> res;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(<a class="code" href="group__base__funcs.html#ga683b6cffc3b9aa9d349d61e12a87a7bb" title="Checks if a string is not empty.">urosStringNotEmpty</a>(namep));</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;  <span class="comment">/* Find the topic descriptor.*/</span></div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;  <a class="code" href="group__threading__funcs.html#ga1db2c55616b4b1264d778c1ae5f25a83" title="Locks a mutex.">urosMutexLock</a>(&amp;urosNode.<a class="code" href="struct_uros_node.html#a5824c0ae5741fd90f941e81ce22fac13" title="Node status.">status</a>.<a class="code" href="struct_uros_node_status.html#afe2468e629b5497699cdd79b3e134f95" title="Topic subscriptions lock.">subTopicListLock</a>);</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;  topicnodep = <a class="code" href="group__base__funcs.html#gaf3be0d7e379f41fd664bf2d6356fe84f" title="Gets the list node referencing a topic with the requested name.">urosTopicListFindByName</a>(&amp;urosNode.<a class="code" href="struct_uros_node.html#a5824c0ae5741fd90f941e81ce22fac13" title="Node status.">status</a>.<a class="code" href="struct_uros_node_status.html#ac1b16540d46ba17899d6a1d715ec8ffd" title="List of topic subscriptions.">subTopicList</a>, namep);</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;  <span class="keywordflow">if</span> (topicnodep == NULL) {</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    <a class="code" href="group__base__macros.html#gae2617103c16f3e9d923d712289011471" title="Checks if an error occurred, and generates a message.">urosError</a>(topicnodep == NULL,</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;              { err = <a class="code" href="group__base__types.html#ggaac94ee32652dcb53686fdf6881996b6ca19c137733c13835c93db1cc3099c7a83" title="Bad parameter.">UROS_ERR_BADPARAM</a>; <span class="keywordflow">goto</span> _finally; },</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;              (<span class="stringliteral">&quot;Topic [%.*s] not subscribed\n&quot;</span>, <a class="code" href="group__base__macros.html#ga0944421111e89ed6889954cb67c58bcd" title="Makes the formatted parameters for an UrosString object.">UROS_STRARG</a>(namep)));</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;  }</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;  topicp = (<a class="code" href="struct_uros_topic.html" title="Topic descriptor.">UrosTopic</a>*)topicnodep-&gt;<a class="code" href="struct_uros_list_node.html#ab88d07767307bb2312d50abf2e87833b" title="Generic data pointer.">datap</a>;</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;  <span class="comment">/* Unregister the topic on the Master node.*/</span></div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;  err = <a class="code" href="group__rpc__call__funcs.html#gac6691eb9b6ffd45bf1039507a797ac73" title="Unregister the caller as a publisher of the topic.">urosRpcCallUnregisterSubscriber</a>(</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    &amp;urosNode.<a class="code" href="struct_uros_node.html#adc952e6ab7c3a6fa73a3f35f445dce8b" title="Node configuration (loaded at boot time).">config</a>.<a class="code" href="struct_uros_node_config.html#a433cf14823804cddc8f34870f57f061f" title="ROS Master XMLRPC server address.">masterAddr</a>,</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    &amp;urosNode.<a class="code" href="struct_uros_node.html#adc952e6ab7c3a6fa73a3f35f445dce8b" title="Node configuration (loaded at boot time).">config</a>.<a class="code" href="struct_uros_node_config.html#ac2ab2f5d771a355846f4a88bcaf86c39" title="Node name.">nodeName</a>,</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    namep,</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    &amp;urosNode.<a class="code" href="struct_uros_node.html#adc952e6ab7c3a6fa73a3f35f445dce8b" title="Node configuration (loaded at boot time).">config</a>.<a class="code" href="struct_uros_node_config.html#aa741eb4fd467dba559ec3f58293f022e" title="XMLRPC Listener URI.">xmlrpcUri</a>,</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    &amp;res</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;  );</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;  <a class="code" href="group__base__macros.html#gae2617103c16f3e9d923d712289011471" title="Checks if an error occurred, and generates a message.">urosError</a>(err != <a class="code" href="group__base__types.html#ggaac94ee32652dcb53686fdf6881996b6ca2aa45ad0fcc039cef995b754c97f63ce" title="No errors.">UROS_OK</a>, <a class="code" href="group__base__macros.html#ga159478ffa2ebe6a29bda7446baa7c44a" title="No operation placeholder.">UROS_NOP</a>,</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;            (<span class="stringliteral">&quot;Error %s while unregistering as subscriber of topic [%.*s]\n&quot;</span>,</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;             <a class="code" href="group__base__funcs.html#gaffc66585c4773691fb36881ecf8bab2a" title="Text of an error code.">urosErrorText</a>(err), <a class="code" href="group__base__macros.html#ga0944421111e89ed6889954cb67c58bcd" title="Makes the formatted parameters for an UrosString object.">UROS_STRARG</a>(namep)));</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;  <span class="comment">/* Unregister the topic locally.*/</span></div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;  topicp-&gt;<a class="code" href="struct_uros_topic.html#a3730873d8d9cb05efed9343c53fc1f57" title="Topic/Service flags.">flags</a>.<a class="code" href="structuros__topicflags__t.html#aa7325cf4481f1dee71ba9fe3ff8407ed" title="Deleted topic descriptor, free asap.">deleted</a> = <a class="code" href="group__base__macros.html#gafe1e9e4dd81f26e3eeaca59d8416142e" title="true boolean value.">UROS_TRUE</a>;</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;  tcprosnodep = <a class="code" href="group__base__funcs.html#ga778761e65942c459b0b3be5049686d0a" title="Removes a node from the list.">urosListRemove</a>(&amp;urosNode.<a class="code" href="struct_uros_node.html#a5824c0ae5741fd90f941e81ce22fac13" title="Node status.">status</a>.<a class="code" href="struct_uros_node_status.html#ac1b16540d46ba17899d6a1d715ec8ffd" title="List of topic subscriptions.">subTopicList</a>, topicnodep);</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(tcprosnodep == topicnodep);</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;  <a class="code" href="group__threading__funcs.html#ga1db2c55616b4b1264d778c1ae5f25a83" title="Locks a mutex.">urosMutexLock</a>(&amp;urosNode.<a class="code" href="struct_uros_node.html#a5824c0ae5741fd90f941e81ce22fac13" title="Node status.">status</a>.<a class="code" href="struct_uros_node_status.html#a7d3e5ce542819c78c50f7acc533a87e3" title="Subscribed connections lock.">subTcpListLock</a>);</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;  <span class="keywordflow">if</span> (urosNode.<a class="code" href="struct_uros_node.html#a5824c0ae5741fd90f941e81ce22fac13" title="Node status.">status</a>.<a class="code" href="struct_uros_node_status.html#ac9a7d523859b45d5bc6d245114c25121" title="Subscribed TCPROS connections.">subTcpList</a>.<a class="code" href="struct_uros_list.html#a31c61743c1dd1819ae424243ea460558" title="Number of list entries.">length</a> &gt; 0) {</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    <span class="comment">/* Tell each subscribing TCPROS thread to exit.*/</span></div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    <span class="keywordflow">for</span> (tcprosnodep = urosNode.<a class="code" href="struct_uros_node.html#a5824c0ae5741fd90f941e81ce22fac13" title="Node status.">status</a>.<a class="code" href="struct_uros_node_status.html#ac9a7d523859b45d5bc6d245114c25121" title="Subscribed TCPROS connections.">subTcpList</a>.<a class="code" href="struct_uros_list.html#a94a11e13479a04d2887443d8c55a572b" title="Pointer to the list head node.">headp</a>;</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;         tcprosnodep != NULL;</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;         tcprosnodep = tcprosnodep-&gt;<a class="code" href="struct_uros_list_node.html#aa3109ac041ab790fe3e4d4bfa36d3465" title="Pointer to the next list entry node.">nextp</a>) {</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;      <a class="code" href="struct_uros_tcp_ros_status.html" title="TCPROS connection status object.">UrosTcpRosStatus</a> *tcpstp = (<a class="code" href="struct_uros_tcp_ros_status.html" title="TCPROS connection status object.">UrosTcpRosStatus</a>*)tcprosnodep-&gt;<a class="code" href="struct_uros_list_node.html#ab88d07767307bb2312d50abf2e87833b" title="Generic data pointer.">datap</a>;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;      if (tcpstp-&gt;<a class="code" href="struct_uros_tcp_ros_status.html#afc1b0399b8b6dc23c58672813889a1b4" title="Referenced topic/service.">topicp</a> == topicp &amp;&amp; !tcpstp-&gt;<a class="code" href="struct_uros_tcp_ros_status.html#ad2ef0a50c4176a846aaf6898b30d6d3f" title="Topic/Service flags.">flags</a>.<a class="code" href="structuros__topicflags__t.html#a7cfab42a7b27fac28fae7b6f69d4ae73" title="Service/!TcpStatus connection.">service</a>) {</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;        <a class="code" href="group__threading__funcs.html#ga1db2c55616b4b1264d778c1ae5f25a83" title="Locks a mutex.">urosMutexLock</a>(&amp;tcpstp-&gt;<a class="code" href="struct_uros_tcp_ros_status.html#a4ca5f3fd7d69271a17d6f464e0dc33d1" title="Thread exit request mutex.">threadExitMtx</a>);</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;        tcpstp-&gt;<a class="code" href="struct_uros_tcp_ros_status.html#a972798677a09c11fcd646e73fe5abc86" title="Thread exit request.">threadExit</a> = <a class="code" href="group__base__macros.html#gafe1e9e4dd81f26e3eeaca59d8416142e" title="true boolean value.">UROS_TRUE</a>;</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;        <a class="code" href="group__threading__funcs.html#ga35dba778a18d8708fcf957da4e5110b3" title="Unlocks a mutex.">urosMutexUnlock</a>(&amp;tcpstp-&gt;<a class="code" href="struct_uros_tcp_ros_status.html#a4ca5f3fd7d69271a17d6f464e0dc33d1" title="Thread exit request mutex.">threadExitMtx</a>);</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;      }</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    }</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    <span class="comment">/* NOTE: The last exiting thread freeds the topic descriptor.*/</span></div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    <span class="comment">/* No TCPROS connections, just free the descriptor immediately.*/</span></div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    <a class="code" href="group__base__funcs.html#ga16bb69f7a4f4c18940a3680a41a62f37" title="Deallocates a list node.">urosListNodeDelete</a>(topicnodep, (<a class="code" href="group__base__types.html#ga3f6900a333ee4b24db9b520c7e55abc8" title="Deletion procedure.">uros_delete_f</a>)<a class="code" href="group__base__funcs.html#ga4d08e89758fa879909cd58df47bf4d94" title="Deallocates a topic descriptor.">urosTopicDelete</a>);</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;  }</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;_finally:</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;  <a class="code" href="group__threading__funcs.html#ga35dba778a18d8708fcf957da4e5110b3" title="Unlocks a mutex.">urosMutexUnlock</a>(&amp;urosNode.<a class="code" href="struct_uros_node.html#a5824c0ae5741fd90f941e81ce22fac13" title="Node status.">status</a>.<a class="code" href="struct_uros_node_status.html#afe2468e629b5497699cdd79b3e134f95" title="Topic subscriptions lock.">subTopicListLock</a>);</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;  <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;}</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;<span class="comment"> * TODO</span></div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00657"></a><span class="lineno"><a class="code" href="group__node__funcs.html#gabcc745049a22e8be757283cb534565e0">  657</a></span>&#160;<a class="code" href="group__base__types.html#gaac94ee32652dcb53686fdf6881996b6c" title="Error codes enumerator.">uros_err_t</a> <a class="code" href="group__node__funcs.html#gabcc745049a22e8be757283cb534565e0">urosNodePublishService</a>(<span class="keyword">const</span> <a class="code" href="struct_uros_string.html" title="String object.">UrosString</a> *namep,</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;                                  <span class="keyword">const</span> <a class="code" href="struct_uros_string.html" title="String object.">UrosString</a> *typep,</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;                                  <a class="code" href="group__base__types.html#ga7f1ff17e59a50f61ce7e3c18fdae5306" title="One-parameter procedure function pointer.">uros_proc_f</a> procf) {</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;  <a class="code" href="struct_uros_topic.html" title="Topic descriptor.">UrosTopic</a> *servicep;</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;  <span class="keyword">const</span> <a class="code" href="struct_uros_msg_type.html" title="Message type descriptor.">UrosMsgType</a> *statictypep;</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;  <a class="code" href="struct_uros_list_node.html" title="List node, forward only.">UrosListNode</a> *servicenodep;</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;  <a class="code" href="group__base__types.html#gaac94ee32652dcb53686fdf6881996b6c" title="Error codes enumerator.">uros_err_t</a> err;</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(<a class="code" href="group__base__funcs.html#ga683b6cffc3b9aa9d349d61e12a87a7bb" title="Checks if a string is not empty.">urosStringNotEmpty</a>(namep));</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(<a class="code" href="group__base__funcs.html#ga683b6cffc3b9aa9d349d61e12a87a7bb" title="Checks if a string is not empty.">urosStringNotEmpty</a>(typep));</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(procf != NULL);</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;  <span class="comment">/* Get the registered service type.*/</span></div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;  statictypep = <a class="code" href="group__base__funcs.html#ga13754ff12d667881c4d8db5c3fa9922c" title="Gets the service type descriptor with the requested name.">urosFindStaticSrvType</a>(typep);</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;  <a class="code" href="group__base__macros.html#gae2617103c16f3e9d923d712289011471" title="Checks if an error occurred, and generates a message.">urosError</a>(statictypep == NULL, <span class="keywordflow">return</span> <a class="code" href="group__base__types.html#ggaac94ee32652dcb53686fdf6881996b6ca19c137733c13835c93db1cc3099c7a83" title="Bad parameter.">UROS_ERR_BADPARAM</a>,</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;            (<span class="stringliteral">&quot;Unknown message type [%.*s]\n&quot;</span>, <a class="code" href="group__base__macros.html#ga0944421111e89ed6889954cb67c58bcd" title="Makes the formatted parameters for an UrosString object.">UROS_STRARG</a>(typep)));</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;  <span class="comment">/* Check if the service already exists.*/</span></div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;  <a class="code" href="group__threading__funcs.html#ga1db2c55616b4b1264d778c1ae5f25a83" title="Locks a mutex.">urosMutexLock</a>(&amp;urosNode.<a class="code" href="struct_uros_node.html#a5824c0ae5741fd90f941e81ce22fac13" title="Node status.">status</a>.<a class="code" href="struct_uros_node_status.html#aea5546bf63f7cabcaebc7e377d50ca68" title="Publisher connections lock.">pubServiceListLock</a>);</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;  servicenodep = <a class="code" href="group__base__funcs.html#gaf3be0d7e379f41fd664bf2d6356fe84f" title="Gets the list node referencing a topic with the requested name.">urosTopicListFindByName</a>(&amp;urosNode.<a class="code" href="struct_uros_node.html#a5824c0ae5741fd90f941e81ce22fac13" title="Node status.">status</a>.<a class="code" href="struct_uros_node_status.html#af9e382b0941d31b46d918e1dbac524bc" title="List of published services.">pubServiceList</a>,</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;                                         namep);</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;  <a class="code" href="group__threading__funcs.html#ga35dba778a18d8708fcf957da4e5110b3" title="Unlocks a mutex.">urosMutexUnlock</a>(&amp;urosNode.<a class="code" href="struct_uros_node.html#a5824c0ae5741fd90f941e81ce22fac13" title="Node status.">status</a>.<a class="code" href="struct_uros_node_status.html#aea5546bf63f7cabcaebc7e377d50ca68" title="Publisher connections lock.">pubServiceListLock</a>);</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;  <a class="code" href="group__base__macros.html#gae2617103c16f3e9d923d712289011471" title="Checks if an error occurred, and generates a message.">urosError</a>(servicenodep != NULL, <span class="keywordflow">return</span> UROS_ERR_BADPARAM,</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;            (<span class="stringliteral">&quot;Service [%.*s] already published\n&quot;</span>, <a class="code" href="group__base__macros.html#ga0944421111e89ed6889954cb67c58bcd" title="Makes the formatted parameters for an UrosString object.">UROS_STRARG</a>(namep)));</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;  <span class="comment">/* Create a new topic descriptor.*/</span></div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;  servicep = <a class="code" href="group__base__macros.html#gaf5fd0f0a25b126bd46328ab6e956dc2d" title="Allocates a typed object.">urosNew</a>(<a class="code" href="struct_uros_topic.html" title="Topic descriptor.">UrosTopic</a>);</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;  <span class="keywordflow">if</span> (servicep == NULL) { <span class="keywordflow">return</span> <a class="code" href="group__base__types.html#ggaac94ee32652dcb53686fdf6881996b6cad6877461eb507108e0b2d8d26608252c" title="Not enough free memory.">UROS_ERR_NOMEM</a>; }</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;  <a class="code" href="group__base__funcs.html#gaeed2817c2f87f5f953f48e44f83a2d5a" title="Initializes a topic descriptor.">urosTopicObjectInit</a>(servicep);</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;  servicep-&gt;<a class="code" href="struct_uros_topic.html#aeff3ee92d44d0e73582c314410d3d141" title="Topic/Service name.">name</a> = <a class="code" href="group__base__funcs.html#gaa06fbc7230d27fd97612c38c7c40d500" title="Clones a string object.">urosStringClone</a>(namep);</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;  servicep-&gt;<a class="code" href="struct_uros_topic.html#a67377ab341821c1906a4b3feac57cb20" title="Topic/Service message type.">typep</a> = statictypep;</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;  servicep-&gt;<a class="code" href="struct_uros_topic.html#a48e8b6a49c7d892cf19854f00251d24d" title="Procedure handler.">procf</a> = procf;</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;  <span class="comment">/* Try to register the topic.*/</span></div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;  err = <a class="code" href="group__node__funcs.html#ga23dd94be8d8eca304c09aa91fa6a7107" title="Publishes a service by its descriptor.">urosNodePublishServiceByDesc</a>(servicep);</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;  <span class="keywordflow">if</span> (err != <a class="code" href="group__base__types.html#ggaac94ee32652dcb53686fdf6881996b6ca2aa45ad0fcc039cef995b754c97f63ce" title="No errors.">UROS_OK</a>) { <a class="code" href="group__base__funcs.html#ga4d08e89758fa879909cd58df47bf4d94" title="Deallocates a topic descriptor.">urosTopicDelete</a>(servicep); }</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;  <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;}</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;<span class="comment"> * TODO</span></div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00700"></a><span class="lineno"><a class="code" href="group__node__funcs.html#gac55452a01fa8c3d8abb2f8f24d73bb85">  700</a></span>&#160;<a class="code" href="group__base__types.html#gaac94ee32652dcb53686fdf6881996b6c" title="Error codes enumerator.">uros_err_t</a> <a class="code" href="group__node__funcs.html#gac55452a01fa8c3d8abb2f8f24d73bb85">urosNodePublishServiceSZ</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *namep,</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;                                    <span class="keyword">const</span> <span class="keywordtype">char</span> *typep,</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;                                    <a class="code" href="group__base__types.html#ga7f1ff17e59a50f61ce7e3c18fdae5306" title="One-parameter procedure function pointer.">uros_proc_f</a> procf) {</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;  <a class="code" href="struct_uros_string.html" title="String object.">UrosString</a> namestr, typestr;</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(namep != NULL);</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(namep[0] != 0);</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(typep != NULL);</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(typep[0] != 0);</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(procf != NULL);</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;  namestr = <a class="code" href="group__base__funcs.html#ga45818844e48c6458a4ab88820a0ef6c1" title="The string object points to a memory chunk.">urosStringAssignZ</a>(namep);</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;  typestr = <a class="code" href="group__base__funcs.html#ga45818844e48c6458a4ab88820a0ef6c1" title="The string object points to a memory chunk.">urosStringAssignZ</a>(typep);</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group__node__funcs.html#gabcc745049a22e8be757283cb534565e0">urosNodePublishService</a>(&amp;namestr, &amp;typestr, procf);</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;}</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;<span class="comment"> * @brief   Publishes a service by its descriptor.</span></div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;<span class="comment"> * @details Issues a @p registerService() call to the XMLRPC Master.</span></div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;<span class="comment"> * @warning The access to the service registry is thread-safe, but delays of</span></div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;<span class="comment"> *          the XMLRPC communication will delay also any other threads trying</span></div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;<span class="comment"> *          to publish/unpublish any services.</span></div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;<span class="comment"> * @see     urosRpcCallRegisterService()</span></div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;<span class="comment"> * @pre     The service is not published.</span></div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;<span class="comment"> * @pre     The service descriptor must have the @p service flag set to @p 1.</span></div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;<span class="comment"> * @post    - If successful, the service descriptor is referenced by the</span></div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;<span class="comment"> *            service registry, and is no longer modifiable by the caller</span></div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;<span class="comment"> *            function.</span></div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;<span class="comment"> *          - If unsuccessful, the service descriptor can be deallocated by the</span></div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;<span class="comment"> *            caller function.</span></div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;<span class="comment"> * @param[in] servicep</span></div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;<span class="comment"> *          Pointer to the service descriptor to be published and registered.</span></div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;<span class="comment"> * @return</span></div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;<span class="comment"> *          Error code.</span></div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00738"></a><span class="lineno"><a class="code" href="group__node__funcs.html#ga23dd94be8d8eca304c09aa91fa6a7107">  738</a></span>&#160;<a class="code" href="group__base__types.html#gaac94ee32652dcb53686fdf6881996b6c" title="Error codes enumerator.">uros_err_t</a> <a class="code" href="group__node__funcs.html#ga23dd94be8d8eca304c09aa91fa6a7107" title="Publishes a service by its descriptor.">urosNodePublishServiceByDesc</a>(<span class="keyword">const</span> <a class="code" href="struct_uros_topic.html" title="Topic descriptor.">UrosTopic</a> *servicep) {</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="struct_uros_node_config.html" title="Node configuration descriptor.">UrosNodeConfig</a> *cfgp = &amp;urosNode.<a class="code" href="struct_uros_node.html#adc952e6ab7c3a6fa73a3f35f445dce8b" title="Node configuration (loaded at boot time).">config</a>;</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;  <a class="code" href="struct_uros_rpc_response.html" title="XMLRPC call response object.">UrosRpcResponse</a> response;</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;  <a class="code" href="group__base__types.html#gaac94ee32652dcb53686fdf6881996b6c" title="Error codes enumerator.">uros_err_t</a> err;</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;  <a class="code" href="struct_uros_list_node.html" title="List node, forward only.">UrosListNode</a> *nodep;</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(servicep != NULL);</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(<a class="code" href="group__base__funcs.html#ga683b6cffc3b9aa9d349d61e12a87a7bb" title="Checks if a string is not empty.">urosStringNotEmpty</a>(&amp;servicep-&gt;<a class="code" href="struct_uros_topic.html#aeff3ee92d44d0e73582c314410d3d141" title="Topic/Service name.">name</a>));</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(servicep-&gt;<a class="code" href="struct_uros_topic.html#a67377ab341821c1906a4b3feac57cb20" title="Topic/Service message type.">typep</a> != NULL);</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(<a class="code" href="group__base__funcs.html#ga683b6cffc3b9aa9d349d61e12a87a7bb" title="Checks if a string is not empty.">urosStringNotEmpty</a>(&amp;servicep-&gt;<a class="code" href="struct_uros_topic.html#a67377ab341821c1906a4b3feac57cb20" title="Topic/Service message type.">typep</a>-&gt;<a class="code" href="struct_uros_msg_type.html#a66908c2943f4d2f1d61e2b7be9ce39fe" title="Type name.">name</a>));</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;  <a class="code" href="group__rpc__funcs.html#ga3aa421f7a9011427fb23add0d0bd80c8" title="Initializes a XMLRPC response.">urosRpcResponseObjectInit</a>(&amp;response);</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;  <a class="code" href="group__threading__funcs.html#ga1db2c55616b4b1264d778c1ae5f25a83" title="Locks a mutex.">urosMutexLock</a>(&amp;urosNode.<a class="code" href="struct_uros_node.html#a5824c0ae5741fd90f941e81ce22fac13" title="Node status.">status</a>.<a class="code" href="struct_uros_node_status.html#aea5546bf63f7cabcaebc7e377d50ca68" title="Publisher connections lock.">pubServiceListLock</a>);</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;  <span class="comment">/* Master XMLRPC registerPublisher() */</span></div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;  err = <a class="code" href="group__rpc__call__funcs.html#ga4e81526f866e1b212b8eda624c2812b2" title="Registers the caller as a provider of the specified service.">urosRpcCallRegisterService</a>(</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    &amp;cfgp-&gt;<a class="code" href="struct_uros_node_config.html#a433cf14823804cddc8f34870f57f061f" title="ROS Master XMLRPC server address.">masterAddr</a>,</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;    &amp;cfgp-&gt;<a class="code" href="struct_uros_node_config.html#ac2ab2f5d771a355846f4a88bcaf86c39" title="Node name.">nodeName</a>,</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    &amp;servicep-&gt;<a class="code" href="struct_uros_topic.html#aeff3ee92d44d0e73582c314410d3d141" title="Topic/Service name.">name</a>,</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;    &amp;cfgp-&gt;<a class="code" href="struct_uros_node_config.html#a1b20a2bfd7eab7a4ba3c1a9e41dfbbe8" title="TCPROS Listener URI.">tcprosUri</a>,</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;    &amp;cfgp-&gt;<a class="code" href="struct_uros_node_config.html#aa741eb4fd467dba559ec3f58293f022e" title="XMLRPC Listener URI.">xmlrpcUri</a>,</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;    &amp;response</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;  );</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;  <a class="code" href="group__base__macros.html#gae2617103c16f3e9d923d712289011471" title="Checks if an error occurred, and generates a message.">urosError</a>(err != <a class="code" href="group__base__types.html#ggaac94ee32652dcb53686fdf6881996b6ca2aa45ad0fcc039cef995b754c97f63ce" title="No errors.">UROS_OK</a>, <span class="keywordflow">goto</span> _finally,</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;            (<span class="stringliteral">&quot;Cannot register service [%.*s]\n&quot;</span>,</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;             <a class="code" href="group__base__macros.html#ga0944421111e89ed6889954cb67c58bcd" title="Makes the formatted parameters for an UrosString object.">UROS_STRARG</a>(&amp;servicep-&gt;<a class="code" href="struct_uros_topic.html#aeff3ee92d44d0e73582c314410d3d141" title="Topic/Service name.">name</a>)));</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;  <span class="comment">/* Check for valid codes.*/</span></div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;  <a class="code" href="group__base__macros.html#gae2617103c16f3e9d923d712289011471" title="Checks if an error occurred, and generates a message.">urosError</a>(response.<a class="code" href="struct_uros_rpc_response.html#a2b2df079d5bf428ca349ecac28bba0ad" title="Response code (.">code</a> != <a class="code" href="group__rpc__types.html#gga17b8b6fc0f50d5d51c58ba1e3259487aa1888553c768a7611c981fa59d40e6fd4" title="Method completed successfully.">UROS_RPCC_SUCCESS</a>,</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;            { <span class="keywordflow">return</span> <a class="code" href="group__base__types.html#ggaac94ee32652dcb53686fdf6881996b6ca19c137733c13835c93db1cc3099c7a83" title="Bad parameter.">UROS_ERR_BADPARAM</a>; <span class="keywordflow">goto</span> _finally; },</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;            (<span class="stringliteral">&quot;Response code %d, expected %d\n&quot;</span>,</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;             response.code, <a class="code" href="group__rpc__types.html#gga17b8b6fc0f50d5d51c58ba1e3259487aa1888553c768a7611c981fa59d40e6fd4" title="Method completed successfully.">UROS_RPCC_SUCCESS</a>));</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;  <a class="code" href="group__base__macros.html#gae2617103c16f3e9d923d712289011471" title="Checks if an error occurred, and generates a message.">urosError</a>(response.httpcode != 200,</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;            { <span class="keywordflow">return</span> <a class="code" href="group__base__types.html#ggaac94ee32652dcb53686fdf6881996b6ca19c137733c13835c93db1cc3099c7a83" title="Bad parameter.">UROS_ERR_BADPARAM</a>; <span class="keywordflow">goto</span> _finally; },</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;            (<span class="stringliteral">&quot;Response HTTP code %d, expected 200\n&quot;</span>, response.httpcode));</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;  <span class="comment">/* Add to the published topics list.*/</span></div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;  nodep = <a class="code" href="group__base__macros.html#gaf5fd0f0a25b126bd46328ab6e956dc2d" title="Allocates a typed object.">urosNew</a>(<a class="code" href="struct_uros_list_node.html" title="List node, forward only.">UrosListNode</a>);</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;  <a class="code" href="group__base__funcs.html#ga04cdcbb27dde6c72beb5d31aea330e6b" title="Initializes a list node.">urosListNodeObjectInit</a>(nodep);</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;  nodep-&gt;datap = (<span class="keywordtype">void</span>*)servicep;</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;  <a class="code" href="group__base__funcs.html#gae5808c2f0aeb0a570ae545f7468acdce" title="Adds a node to the list.">urosListAdd</a>(&amp;urosNode.<a class="code" href="struct_uros_node.html#a5824c0ae5741fd90f941e81ce22fac13" title="Node status.">status</a>.<a class="code" href="struct_uros_node_status.html#af9e382b0941d31b46d918e1dbac524bc" title="List of published services.">pubServiceList</a>, nodep);</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;  err = <a class="code" href="group__base__types.html#ggaac94ee32652dcb53686fdf6881996b6ca2aa45ad0fcc039cef995b754c97f63ce" title="No errors.">UROS_OK</a>;</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;_finally:</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;  <span class="comment">/* Cleanup and return.*/</span></div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;  <a class="code" href="group__threading__funcs.html#ga35dba778a18d8708fcf957da4e5110b3" title="Unlocks a mutex.">urosMutexUnlock</a>(&amp;urosNode.<a class="code" href="struct_uros_node.html#a5824c0ae5741fd90f941e81ce22fac13" title="Node status.">status</a>.<a class="code" href="struct_uros_node_status.html#aea5546bf63f7cabcaebc7e377d50ca68" title="Publisher connections lock.">pubServiceListLock</a>);</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;  <a class="code" href="group__rpc__funcs.html#ga42e2108515c503cc0e89a65c4361b794" title="Cleans a XMLRPC resposnse.">urosRpcResponseClean</a>(&amp;response);</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;  <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;}</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;<span class="comment"> * @brief   Unpublishes a service.</span></div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;<span class="comment"> * @details Issues an @p unregisterService() call to the XMLRPC Master.</span></div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;<span class="comment"> * @see     urosRpcCallUnregisterService()</span></div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;<span class="comment"> * @warning The access to the service registry is thread-safe, but delays of</span></div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;<span class="comment"> *          the XMLRPC communication will delay also any other threads trying</span></div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;<span class="comment"> *          to publish/unpublish any services.</span></div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;<span class="comment"> * @pre     The service is published.</span></div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;<span class="comment"> * @post    If successful, the service descriptor is dereferenced by the</span></div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;<span class="comment"> *          service registry, and will be freed:</span></div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;<span class="comment"> *          - by this function, if there are no publishing TCPROS threads, or</span></div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;<span class="comment"> *          - by the last publishing TCPROS thread which references the</span></div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;<span class="comment"> *            service.</span></div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;<span class="comment"> * @param[in] namep</span></div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;<span class="comment"> *          Pointer to a string which names the service.</span></div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;<span class="comment"> * @return</span></div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;<span class="comment"> *          Error code.</span></div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00809"></a><span class="lineno"><a class="code" href="group__node__funcs.html#ga3c583fe282e14b2a1a8decfdbbdbe971">  809</a></span>&#160;<a class="code" href="group__base__types.html#gaac94ee32652dcb53686fdf6881996b6c" title="Error codes enumerator.">uros_err_t</a> <a class="code" href="group__node__funcs.html#ga3c583fe282e14b2a1a8decfdbbdbe971" title="Unpublishes a service.">urosNodeUnpublishService</a>(<span class="keyword">const</span> <a class="code" href="struct_uros_string.html" title="String object.">UrosString</a> *namep) {</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;  <a class="code" href="struct_uros_list_node.html" title="List node, forward only.">UrosListNode</a> *tcprosnodep, *servicenodep;</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;  <a class="code" href="struct_uros_topic.html" title="Topic descriptor.">UrosTopic</a> *servicep;</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;  <a class="code" href="group__base__types.html#gaac94ee32652dcb53686fdf6881996b6c" title="Error codes enumerator.">uros_err_t</a> err;</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;  <a class="code" href="struct_uros_rpc_response.html" title="XMLRPC call response object.">UrosRpcResponse</a> res;</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(<a class="code" href="group__base__funcs.html#ga683b6cffc3b9aa9d349d61e12a87a7bb" title="Checks if a string is not empty.">urosStringNotEmpty</a>(namep));</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;  <span class="comment">/* Find the service descriptor.*/</span></div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;  <a class="code" href="group__threading__funcs.html#ga1db2c55616b4b1264d778c1ae5f25a83" title="Locks a mutex.">urosMutexLock</a>(&amp;urosNode.<a class="code" href="struct_uros_node.html#a5824c0ae5741fd90f941e81ce22fac13" title="Node status.">status</a>.<a class="code" href="struct_uros_node_status.html#aea5546bf63f7cabcaebc7e377d50ca68" title="Publisher connections lock.">pubServiceListLock</a>);</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;  servicenodep = <a class="code" href="group__base__funcs.html#gaf3be0d7e379f41fd664bf2d6356fe84f" title="Gets the list node referencing a topic with the requested name.">urosTopicListFindByName</a>(&amp;urosNode.<a class="code" href="struct_uros_node.html#a5824c0ae5741fd90f941e81ce22fac13" title="Node status.">status</a>.<a class="code" href="struct_uros_node_status.html#af9e382b0941d31b46d918e1dbac524bc" title="List of published services.">pubServiceList</a>,</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;                                         namep);</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;  <span class="keywordflow">if</span> (servicenodep == NULL) {</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    <a class="code" href="group__base__macros.html#gae2617103c16f3e9d923d712289011471" title="Checks if an error occurred, and generates a message.">urosError</a>(servicenodep == NULL,</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;              { err = <a class="code" href="group__base__types.html#ggaac94ee32652dcb53686fdf6881996b6ca19c137733c13835c93db1cc3099c7a83" title="Bad parameter.">UROS_ERR_BADPARAM</a>; <span class="keywordflow">goto</span> _finally; },</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;              (<span class="stringliteral">&quot;Service [%.*s] not published\n&quot;</span>, <a class="code" href="group__base__macros.html#ga0944421111e89ed6889954cb67c58bcd" title="Makes the formatted parameters for an UrosString object.">UROS_STRARG</a>(namep)));</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;  }</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;  servicep = (<a class="code" href="struct_uros_topic.html" title="Topic descriptor.">UrosTopic</a>*)servicenodep-&gt;<a class="code" href="struct_uros_list_node.html#ab88d07767307bb2312d50abf2e87833b" title="Generic data pointer.">datap</a>;</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;  <span class="comment">/* Unregister the service on the Master node.*/</span></div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;  err = <a class="code" href="group__rpc__call__funcs.html#gae0cf1ce2881b863c0edeba088fecb1ec" title="Unregister the caller as a provider of the specified service.">urosRpcCallUnregisterService</a>(</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;    &amp;urosNode.<a class="code" href="struct_uros_node.html#adc952e6ab7c3a6fa73a3f35f445dce8b" title="Node configuration (loaded at boot time).">config</a>.<a class="code" href="struct_uros_node_config.html#a433cf14823804cddc8f34870f57f061f" title="ROS Master XMLRPC server address.">masterAddr</a>,</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    &amp;urosNode.<a class="code" href="struct_uros_node.html#adc952e6ab7c3a6fa73a3f35f445dce8b" title="Node configuration (loaded at boot time).">config</a>.<a class="code" href="struct_uros_node_config.html#ac2ab2f5d771a355846f4a88bcaf86c39" title="Node name.">nodeName</a>,</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    namep,</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    &amp;urosNode.<a class="code" href="struct_uros_node.html#adc952e6ab7c3a6fa73a3f35f445dce8b" title="Node configuration (loaded at boot time).">config</a>.<a class="code" href="struct_uros_node_config.html#aa741eb4fd467dba559ec3f58293f022e" title="XMLRPC Listener URI.">xmlrpcUri</a>,</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    &amp;res</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;  );</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;  <a class="code" href="group__base__macros.html#gae2617103c16f3e9d923d712289011471" title="Checks if an error occurred, and generates a message.">urosError</a>(err != <a class="code" href="group__base__types.html#ggaac94ee32652dcb53686fdf6881996b6ca2aa45ad0fcc039cef995b754c97f63ce" title="No errors.">UROS_OK</a>, <a class="code" href="group__base__macros.html#ga159478ffa2ebe6a29bda7446baa7c44a" title="No operation placeholder.">UROS_NOP</a>,</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;            (<span class="stringliteral">&quot;Error %s while unregistering as publisher of service [%.*s]\n&quot;</span>,</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;             <a class="code" href="group__base__funcs.html#gaffc66585c4773691fb36881ecf8bab2a" title="Text of an error code.">urosErrorText</a>(err), <a class="code" href="group__base__macros.html#ga0944421111e89ed6889954cb67c58bcd" title="Makes the formatted parameters for an UrosString object.">UROS_STRARG</a>(namep)));</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;  <span class="comment">/* Unregister the service locally.*/</span></div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;  servicep-&gt;<a class="code" href="struct_uros_topic.html#a3730873d8d9cb05efed9343c53fc1f57" title="Topic/Service flags.">flags</a>.<a class="code" href="structuros__topicflags__t.html#aa7325cf4481f1dee71ba9fe3ff8407ed" title="Deleted topic descriptor, free asap.">deleted</a> = <a class="code" href="group__base__macros.html#gafe1e9e4dd81f26e3eeaca59d8416142e" title="true boolean value.">UROS_TRUE</a>;</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;  tcprosnodep = <a class="code" href="group__base__funcs.html#ga778761e65942c459b0b3be5049686d0a" title="Removes a node from the list.">urosListRemove</a>(&amp;urosNode.<a class="code" href="struct_uros_node.html#a5824c0ae5741fd90f941e81ce22fac13" title="Node status.">status</a>.<a class="code" href="struct_uros_node_status.html#af9e382b0941d31b46d918e1dbac524bc" title="List of published services.">pubServiceList</a>, servicenodep);</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(tcprosnodep == servicenodep);</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;  <a class="code" href="group__threading__funcs.html#ga1db2c55616b4b1264d778c1ae5f25a83" title="Locks a mutex.">urosMutexLock</a>(&amp;urosNode.<a class="code" href="struct_uros_node.html#a5824c0ae5741fd90f941e81ce22fac13" title="Node status.">status</a>.<a class="code" href="struct_uros_node_status.html#aaccf2d5947dbe2c31b727e0f8a7a775e" title="Published connections lock.">pubTcpListLock</a>);</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;  <span class="keywordflow">if</span> (urosNode.<a class="code" href="struct_uros_node.html#a5824c0ae5741fd90f941e81ce22fac13" title="Node status.">status</a>.<a class="code" href="struct_uros_node_status.html#a44033dba5661df70b4a8cc19114e57ff" title="Published TCPROS connections.">pubTcpList</a>.<a class="code" href="struct_uros_list.html#a31c61743c1dd1819ae424243ea460558" title="Number of list entries.">length</a> &gt; 0) {</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    <span class="comment">/* Tell each publishing TCPROS thread to exit.*/</span></div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    <span class="keywordflow">for</span> (tcprosnodep = urosNode.<a class="code" href="struct_uros_node.html#a5824c0ae5741fd90f941e81ce22fac13" title="Node status.">status</a>.<a class="code" href="struct_uros_node_status.html#a44033dba5661df70b4a8cc19114e57ff" title="Published TCPROS connections.">pubTcpList</a>.<a class="code" href="struct_uros_list.html#a94a11e13479a04d2887443d8c55a572b" title="Pointer to the list head node.">headp</a>;</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;         tcprosnodep != NULL;</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;         tcprosnodep = tcprosnodep-&gt;<a class="code" href="struct_uros_list_node.html#aa3109ac041ab790fe3e4d4bfa36d3465" title="Pointer to the next list entry node.">nextp</a>) {</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;      <a class="code" href="struct_uros_tcp_ros_status.html" title="TCPROS connection status object.">UrosTcpRosStatus</a> *tcpstp = (<a class="code" href="struct_uros_tcp_ros_status.html" title="TCPROS connection status object.">UrosTcpRosStatus</a>*)tcprosnodep-&gt;<a class="code" href="struct_uros_list_node.html#ab88d07767307bb2312d50abf2e87833b" title="Generic data pointer.">datap</a>;</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;      if (tcpstp-&gt;<a class="code" href="struct_uros_tcp_ros_status.html#afc1b0399b8b6dc23c58672813889a1b4" title="Referenced topic/service.">topicp</a> == servicep &amp;&amp; tcpstp-&gt;<a class="code" href="struct_uros_tcp_ros_status.html#ad2ef0a50c4176a846aaf6898b30d6d3f" title="Topic/Service flags.">flags</a>.<a class="code" href="structuros__topicflags__t.html#a7cfab42a7b27fac28fae7b6f69d4ae73" title="Service/!TcpStatus connection.">service</a>) {</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;        <a class="code" href="group__threading__funcs.html#ga1db2c55616b4b1264d778c1ae5f25a83" title="Locks a mutex.">urosMutexLock</a>(&amp;tcpstp-&gt;<a class="code" href="struct_uros_tcp_ros_status.html#a4ca5f3fd7d69271a17d6f464e0dc33d1" title="Thread exit request mutex.">threadExitMtx</a>);</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;        tcpstp-&gt;<a class="code" href="struct_uros_tcp_ros_status.html#a972798677a09c11fcd646e73fe5abc86" title="Thread exit request.">threadExit</a> = <a class="code" href="group__base__macros.html#gafe1e9e4dd81f26e3eeaca59d8416142e" title="true boolean value.">UROS_TRUE</a>;</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;        <a class="code" href="group__threading__funcs.html#ga35dba778a18d8708fcf957da4e5110b3" title="Unlocks a mutex.">urosMutexUnlock</a>(&amp;tcpstp-&gt;<a class="code" href="struct_uros_tcp_ros_status.html#a4ca5f3fd7d69271a17d6f464e0dc33d1" title="Thread exit request mutex.">threadExitMtx</a>);</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;      }</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;    }</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    <span class="comment">/* NOTE: The last exiting thread freeds the service descriptor.*/</span></div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;    <span class="comment">/* No TCPROS connections, just free the descriptor immediately.*/</span></div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    <a class="code" href="group__base__funcs.html#ga16bb69f7a4f4c18940a3680a41a62f37" title="Deallocates a list node.">urosListNodeDelete</a>(servicenodep, (<a class="code" href="group__base__types.html#ga3f6900a333ee4b24db9b520c7e55abc8" title="Deletion procedure.">uros_delete_f</a>)<a class="code" href="group__base__funcs.html#ga4d08e89758fa879909cd58df47bf4d94" title="Deallocates a topic descriptor.">urosTopicDelete</a>);</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;  }</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;_finally:</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;  <a class="code" href="group__threading__funcs.html#ga35dba778a18d8708fcf957da4e5110b3" title="Unlocks a mutex.">urosMutexUnlock</a>(&amp;urosNode.<a class="code" href="struct_uros_node.html#a5824c0ae5741fd90f941e81ce22fac13" title="Node status.">status</a>.<a class="code" href="struct_uros_node_status.html#aea5546bf63f7cabcaebc7e377d50ca68" title="Publisher connections lock.">pubServiceListLock</a>);</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;  <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;}</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;<span class="comment"> * TODO</span></div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00874"></a><span class="lineno"><a class="code" href="group__node__funcs.html#ga57066b1bc73c5654171f34af5d19456d">  874</a></span>&#160;<a class="code" href="group__base__types.html#gaac94ee32652dcb53686fdf6881996b6c" title="Error codes enumerator.">uros_err_t</a> <a class="code" href="group__node__funcs.html#ga57066b1bc73c5654171f34af5d19456d">urosNodeSubscribeParam</a>(<span class="keyword">const</span> <a class="code" href="struct_uros_string.html" title="String object.">UrosString</a> *namep) {</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;  <a class="code" href="struct_uros_topic.html" title="Topic descriptor.">UrosTopic</a> *paramp;</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;  <a class="code" href="struct_uros_list_node.html" title="List node, forward only.">UrosListNode</a> *paramnodep;</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;  <a class="code" href="group__base__types.html#gaac94ee32652dcb53686fdf6881996b6c" title="Error codes enumerator.">uros_err_t</a> err;</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(<a class="code" href="group__base__funcs.html#ga683b6cffc3b9aa9d349d61e12a87a7bb" title="Checks if a string is not empty.">urosStringNotEmpty</a>(namep));</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;  <span class="comment">/* Check if the topic already exists.*/</span></div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;  <a class="code" href="group__threading__funcs.html#ga1db2c55616b4b1264d778c1ae5f25a83" title="Locks a mutex.">urosMutexLock</a>(&amp;urosNode.<a class="code" href="struct_uros_node.html#a5824c0ae5741fd90f941e81ce22fac13" title="Node status.">status</a>.<a class="code" href="struct_uros_node_status.html#a5dc9190bee28e9ded208382d733df660" title="Parameter subscriptions lock.">subParamListLock</a>);</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;  paramnodep = <a class="code" href="group__base__funcs.html#gaf3be0d7e379f41fd664bf2d6356fe84f" title="Gets the list node referencing a topic with the requested name.">urosTopicListFindByName</a>(&amp;urosNode.<a class="code" href="struct_uros_node.html#a5824c0ae5741fd90f941e81ce22fac13" title="Node status.">status</a>.<a class="code" href="struct_uros_node_status.html#a808a345aa9bf26dccaf5c348b4da5ec7" title="List of parameter subscriptions.">subParamList</a>, namep);</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;  <a class="code" href="group__threading__funcs.html#ga35dba778a18d8708fcf957da4e5110b3" title="Unlocks a mutex.">urosMutexUnlock</a>(&amp;urosNode.<a class="code" href="struct_uros_node.html#a5824c0ae5741fd90f941e81ce22fac13" title="Node status.">status</a>.<a class="code" href="struct_uros_node_status.html#a5dc9190bee28e9ded208382d733df660" title="Parameter subscriptions lock.">subParamListLock</a>);</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;  <a class="code" href="group__base__macros.html#gae2617103c16f3e9d923d712289011471" title="Checks if an error occurred, and generates a message.">urosError</a>(paramnodep != NULL, <span class="keywordflow">return</span> <a class="code" href="group__base__types.html#ggaac94ee32652dcb53686fdf6881996b6ca19c137733c13835c93db1cc3099c7a83" title="Bad parameter.">UROS_ERR_BADPARAM</a>,</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;            (<span class="stringliteral">&quot;Parameter [%.*s] already subscribed\n&quot;</span>, <a class="code" href="group__base__macros.html#ga0944421111e89ed6889954cb67c58bcd" title="Makes the formatted parameters for an UrosString object.">UROS_STRARG</a>(namep)));</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;  <span class="comment">/* Create a new topic descriptor.*/</span></div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;  paramp = <a class="code" href="group__base__macros.html#gaf5fd0f0a25b126bd46328ab6e956dc2d" title="Allocates a typed object.">urosNew</a>(<a class="code" href="struct_uros_topic.html" title="Topic descriptor.">UrosTopic</a>);</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;  <span class="keywordflow">if</span> (paramp == NULL) { <span class="keywordflow">return</span> <a class="code" href="group__base__types.html#ggaac94ee32652dcb53686fdf6881996b6cad6877461eb507108e0b2d8d26608252c" title="Not enough free memory.">UROS_ERR_NOMEM</a>; }</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;  <a class="code" href="group__base__funcs.html#gaeed2817c2f87f5f953f48e44f83a2d5a" title="Initializes a topic descriptor.">urosTopicObjectInit</a>(paramp);</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;  paramp-&gt;<a class="code" href="struct_uros_topic.html#aeff3ee92d44d0e73582c314410d3d141" title="Topic/Service name.">name</a> = <a class="code" href="group__base__funcs.html#gaa06fbc7230d27fd97612c38c7c40d500" title="Clones a string object.">urosStringClone</a>(namep);</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;  <span class="comment">/* Subscribe to the topic.*/</span></div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;  err = <a class="code" href="group__node__funcs.html#ga2eed510f72ca4194a3a1b44d31761e1d" title="Subscribes to a parameter by its descriptor.">urosNodeSubscribeParamByDesc</a>(paramp);</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;  <span class="keywordflow">if</span> (err != <a class="code" href="group__base__types.html#ggaac94ee32652dcb53686fdf6881996b6ca2aa45ad0fcc039cef995b754c97f63ce" title="No errors.">UROS_OK</a>) { <a class="code" href="group__base__funcs.html#ga4d08e89758fa879909cd58df47bf4d94" title="Deallocates a topic descriptor.">urosTopicDelete</a>(paramp); }</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;  <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;}</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;<span class="comment"> * TODO</span></div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00904"></a><span class="lineno"><a class="code" href="group__node__funcs.html#gaef9ef455659c6ba731a3d6f9556a07bc">  904</a></span>&#160;<a class="code" href="group__base__types.html#gaac94ee32652dcb53686fdf6881996b6c" title="Error codes enumerator.">uros_err_t</a> <a class="code" href="group__node__funcs.html#gaef9ef455659c6ba731a3d6f9556a07bc">urosNodeSubscribeParamSZ</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *namep) {</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;  <a class="code" href="struct_uros_string.html" title="String object.">UrosString</a> namestr;</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(namep != NULL);</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(namep[0] != 0);</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;  namestr = <a class="code" href="group__base__funcs.html#ga45818844e48c6458a4ab88820a0ef6c1" title="The string object points to a memory chunk.">urosStringAssignZ</a>(namep);</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group__node__funcs.html#ga57066b1bc73c5654171f34af5d19456d">urosNodeSubscribeParam</a>(&amp;namestr);</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;}</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;<span class="comment"> * @brief   Subscribes to a parameter by its descriptor.</span></div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;<span class="comment"> * @details Issues a @p subscribeParam() call to the XMLRPC Master, and</span></div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;<span class="comment"> *          connects to known publishers.</span></div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;<span class="comment"> * @see     urosRpcCallSubscribeParam()</span></div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;<span class="comment"> * @warning The access to the parameter registry is thread-safe, but delays of</span></div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;<span class="comment"> *          the XMLRPC communication will delay also any other threads trying</span></div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;<span class="comment"> *          to subscribe/unsubscribe to any parameters.</span></div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;<span class="comment"> * @pre     The parameter has not been registered yet.</span></div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;<span class="comment"> * @post    - If successful, the parameter descriptor is referenced by the</span></div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;<span class="comment"> *            parameter registry, and is no longer modifiable by the caller</span></div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;<span class="comment"> *            function.</span></div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;<span class="comment"> *          - If unsuccessful, the parameter descriptor can be deallocated by</span></div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;<span class="comment"> *            the caller function.</span></div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;<span class="comment"> * @param[in] paramp</span></div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;<span class="comment"> *          Pointer to the parameter descriptor to be subscribed to and</span></div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;<span class="comment"> *          registered.</span></div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;<span class="comment"> * @return</span></div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;<span class="comment"> *          Error code.</span></div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00937"></a><span class="lineno"><a class="code" href="group__node__funcs.html#ga2eed510f72ca4194a3a1b44d31761e1d">  937</a></span>&#160;<a class="code" href="group__base__types.html#gaac94ee32652dcb53686fdf6881996b6c" title="Error codes enumerator.">uros_err_t</a> <a class="code" href="group__node__funcs.html#ga2eed510f72ca4194a3a1b44d31761e1d" title="Subscribes to a parameter by its descriptor.">urosNodeSubscribeParamByDesc</a>(<span class="keyword">const</span> <a class="code" href="struct_uros_topic.html" title="Topic descriptor.">UrosTopic</a> *paramp) {</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="struct_uros_node_config.html" title="Node configuration descriptor.">UrosNodeConfig</a> *cfgp = &amp;urosNode.<a class="code" href="struct_uros_node.html#adc952e6ab7c3a6fa73a3f35f445dce8b" title="Node configuration (loaded at boot time).">config</a>;</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;  <a class="code" href="struct_uros_rpc_response.html" title="XMLRPC call response object.">UrosRpcResponse</a> response;</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;  <a class="code" href="group__base__types.html#gaac94ee32652dcb53686fdf6881996b6c" title="Error codes enumerator.">uros_err_t</a> err;</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;  <a class="code" href="struct_uros_list_node.html" title="List node, forward only.">UrosListNode</a> *nodep;</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(paramp != NULL);</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(<a class="code" href="group__base__funcs.html#ga683b6cffc3b9aa9d349d61e12a87a7bb" title="Checks if a string is not empty.">urosStringNotEmpty</a>(&amp;paramp-&gt;<a class="code" href="struct_uros_topic.html#aeff3ee92d44d0e73582c314410d3d141" title="Topic/Service name.">name</a>));</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;  <a class="code" href="group__rpc__funcs.html#ga3aa421f7a9011427fb23add0d0bd80c8" title="Initializes a XMLRPC response.">urosRpcResponseObjectInit</a>(&amp;response);</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;  <a class="code" href="group__threading__funcs.html#ga1db2c55616b4b1264d778c1ae5f25a83" title="Locks a mutex.">urosMutexLock</a>(&amp;urosNode.<a class="code" href="struct_uros_node.html#a5824c0ae5741fd90f941e81ce22fac13" title="Node status.">status</a>.<a class="code" href="struct_uros_node_status.html#a5dc9190bee28e9ded208382d733df660" title="Parameter subscriptions lock.">subParamListLock</a>);</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;  <span class="comment">/* Master XMLRPC registerSubscriber() */</span></div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;  err = <a class="code" href="group__rpc__call__funcs.html#gaca4c310214b0589aa7b0ca106cda8ba7" title="Retrieve parameter value from server and subscribe to updates to that param.">urosRpcCallSubscribeParam</a>(</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;    &amp;cfgp-&gt;<a class="code" href="struct_uros_node_config.html#a433cf14823804cddc8f34870f57f061f" title="ROS Master XMLRPC server address.">masterAddr</a>,</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;    &amp;cfgp-&gt;<a class="code" href="struct_uros_node_config.html#ac2ab2f5d771a355846f4a88bcaf86c39" title="Node name.">nodeName</a>,</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;    &amp;cfgp-&gt;<a class="code" href="struct_uros_node_config.html#aa741eb4fd467dba559ec3f58293f022e" title="XMLRPC Listener URI.">xmlrpcUri</a>,</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;    &amp;paramp-&gt;<a class="code" href="struct_uros_topic.html#aeff3ee92d44d0e73582c314410d3d141" title="Topic/Service name.">name</a>,</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;    &amp;response</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;  );</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;  <a class="code" href="group__base__macros.html#gae2617103c16f3e9d923d712289011471" title="Checks if an error occurred, and generates a message.">urosError</a>(err != <a class="code" href="group__base__types.html#ggaac94ee32652dcb53686fdf6881996b6ca2aa45ad0fcc039cef995b754c97f63ce" title="No errors.">UROS_OK</a>, <span class="keywordflow">goto</span> _finally,</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;            (<span class="stringliteral">&quot;Cannot subscribe to parameter [%.*s]\n&quot;</span>,</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;             <a class="code" href="group__base__macros.html#ga0944421111e89ed6889954cb67c58bcd" title="Makes the formatted parameters for an UrosString object.">UROS_STRARG</a>(&amp;paramp-&gt;<a class="code" href="struct_uros_topic.html#aeff3ee92d44d0e73582c314410d3d141" title="Topic/Service name.">name</a>)));</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;  <span class="comment">/* Check for valid codes.*/</span></div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;  <a class="code" href="group__base__macros.html#gae2617103c16f3e9d923d712289011471" title="Checks if an error occurred, and generates a message.">urosError</a>(response.<a class="code" href="struct_uros_rpc_response.html#a2b2df079d5bf428ca349ecac28bba0ad" title="Response code (.">code</a> != <a class="code" href="group__rpc__types.html#gga17b8b6fc0f50d5d51c58ba1e3259487aa1888553c768a7611c981fa59d40e6fd4" title="Method completed successfully.">UROS_RPCC_SUCCESS</a>,</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;            { <span class="keywordflow">return</span> <a class="code" href="group__base__types.html#ggaac94ee32652dcb53686fdf6881996b6ca19c137733c13835c93db1cc3099c7a83" title="Bad parameter.">UROS_ERR_BADPARAM</a>; <span class="keywordflow">goto</span> _finally; },</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;            (<span class="stringliteral">&quot;Response code %d, expected %d\n&quot;</span>,</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;             response.code, <a class="code" href="group__rpc__types.html#gga17b8b6fc0f50d5d51c58ba1e3259487aa1888553c768a7611c981fa59d40e6fd4" title="Method completed successfully.">UROS_RPCC_SUCCESS</a>));</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;  <a class="code" href="group__base__macros.html#gae2617103c16f3e9d923d712289011471" title="Checks if an error occurred, and generates a message.">urosError</a>(response.httpcode != 200,</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;            { <span class="keywordflow">return</span> <a class="code" href="group__base__types.html#ggaac94ee32652dcb53686fdf6881996b6ca19c137733c13835c93db1cc3099c7a83" title="Bad parameter.">UROS_ERR_BADPARAM</a>; <span class="keywordflow">goto</span> _finally; },</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;            (<span class="stringliteral">&quot;Response HTTP code %d, expected 200\n&quot;</span>, response.httpcode));</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;  <span class="comment">/* Add to the subscribed topics list.*/</span></div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;  nodep = <a class="code" href="group__base__macros.html#gaf5fd0f0a25b126bd46328ab6e956dc2d" title="Allocates a typed object.">urosNew</a>(<a class="code" href="struct_uros_list_node.html" title="List node, forward only.">UrosListNode</a>);</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;  <a class="code" href="group__base__funcs.html#ga04cdcbb27dde6c72beb5d31aea330e6b" title="Initializes a list node.">urosListNodeObjectInit</a>(nodep);</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;  nodep-&gt;datap = (<span class="keywordtype">void</span>*)paramp;</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;  <a class="code" href="group__base__funcs.html#gae5808c2f0aeb0a570ae545f7468acdce" title="Adds a node to the list.">urosListAdd</a>(&amp;urosNode.<a class="code" href="struct_uros_node.html#a5824c0ae5741fd90f941e81ce22fac13" title="Node status.">status</a>.<a class="code" href="struct_uros_node_status.html#a808a345aa9bf26dccaf5c348b4da5ec7" title="List of parameter subscriptions.">subParamList</a>, nodep);</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;  err = <a class="code" href="group__base__types.html#ggaac94ee32652dcb53686fdf6881996b6ca2aa45ad0fcc039cef995b754c97f63ce" title="No errors.">UROS_OK</a>;</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;_finally:</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;  <span class="comment">/* Cleanup and return.*/</span></div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;  <a class="code" href="group__threading__funcs.html#ga35dba778a18d8708fcf957da4e5110b3" title="Unlocks a mutex.">urosMutexUnlock</a>(&amp;urosNode.<a class="code" href="struct_uros_node.html#a5824c0ae5741fd90f941e81ce22fac13" title="Node status.">status</a>.<a class="code" href="struct_uros_node_status.html#a5dc9190bee28e9ded208382d733df660" title="Parameter subscriptions lock.">subParamListLock</a>);</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;  <a class="code" href="group__rpc__funcs.html#ga42e2108515c503cc0e89a65c4361b794" title="Cleans a XMLRPC resposnse.">urosRpcResponseClean</a>(&amp;response);</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;  <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;}</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;<span class="comment"> * @brief   Subscribes to a parameter.</span></div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;<span class="comment"> * @details Issues an @p unsubscribeParam() call to the XMLRPC Master, and</span></div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;<span class="comment"> *          connects to known publishers.</span></div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;<span class="comment"> * @see     urosRpcCallUnubscribeParam()</span></div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;<span class="comment"> * @warning The access to the parameter registry is thread-safe, but delays of</span></div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;<span class="comment"> *          the XMLRPC communication will delay also any other threads trying</span></div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;<span class="comment"> *          to subscribe/unsubscribe to any parameters.</span></div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;<span class="comment"> * @pre     The parameter has been registered.</span></div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;<span class="comment"> * @post    If successful, the parameter descriptor is unreferenced and deleted</span></div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;<span class="comment"> *          by the parameter registry.</span></div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;<span class="comment"> * @param[in] namep</span></div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;<span class="comment"> *          Pointer to a string which names the parameter to be unregistered.</span></div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;<span class="comment"> * @return</span></div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;<span class="comment"> *          Error code.</span></div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01003"></a><span class="lineno"><a class="code" href="group__node__funcs.html#ga0ec4ef27932603646162bef8bf15c16c"> 1003</a></span>&#160;<a class="code" href="group__base__types.html#gaac94ee32652dcb53686fdf6881996b6c" title="Error codes enumerator.">uros_err_t</a> <a class="code" href="group__node__funcs.html#ga0ec4ef27932603646162bef8bf15c16c" title="Subscribes to a parameter.">urosNodeUnsubscribeParam</a>(<span class="keyword">const</span> <a class="code" href="struct_uros_string.html" title="String object.">UrosString</a> *namep) {</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="struct_uros_node_config.html" title="Node configuration descriptor.">UrosNodeConfig</a> *cfgp = &amp;urosNode.<a class="code" href="struct_uros_node.html#adc952e6ab7c3a6fa73a3f35f445dce8b" title="Node configuration (loaded at boot time).">config</a>;</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;  <a class="code" href="struct_uros_rpc_response.html" title="XMLRPC call response object.">UrosRpcResponse</a> response;</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;  <a class="code" href="group__base__types.html#gaac94ee32652dcb53686fdf6881996b6c" title="Error codes enumerator.">uros_err_t</a> err;</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;  <a class="code" href="struct_uros_list_node.html" title="List node, forward only.">UrosListNode</a> *nodep;</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(<a class="code" href="group__base__funcs.html#ga683b6cffc3b9aa9d349d61e12a87a7bb" title="Checks if a string is not empty.">urosStringNotEmpty</a>(namep));</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;  <a class="code" href="group__rpc__funcs.html#ga3aa421f7a9011427fb23add0d0bd80c8" title="Initializes a XMLRPC response.">urosRpcResponseObjectInit</a>(&amp;response);</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;  <a class="code" href="group__threading__funcs.html#ga1db2c55616b4b1264d778c1ae5f25a83" title="Locks a mutex.">urosMutexLock</a>(&amp;urosNode.<a class="code" href="struct_uros_node.html#a5824c0ae5741fd90f941e81ce22fac13" title="Node status.">status</a>.<a class="code" href="struct_uros_node_status.html#a5dc9190bee28e9ded208382d733df660" title="Parameter subscriptions lock.">subParamListLock</a>);</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;  <span class="comment">/* Check if the parameter was actually subscribed.*/</span></div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;  nodep = <a class="code" href="group__base__funcs.html#gaf3be0d7e379f41fd664bf2d6356fe84f" title="Gets the list node referencing a topic with the requested name.">urosTopicListFindByName</a>(&amp;urosNode.<a class="code" href="struct_uros_node.html#a5824c0ae5741fd90f941e81ce22fac13" title="Node status.">status</a>.<a class="code" href="struct_uros_node_status.html#a808a345aa9bf26dccaf5c348b4da5ec7" title="List of parameter subscriptions.">subParamList</a>, namep);</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;  <a class="code" href="group__base__macros.html#gae2617103c16f3e9d923d712289011471" title="Checks if an error occurred, and generates a message.">urosError</a>(nodep == NULL, <span class="keywordflow">return</span> <a class="code" href="group__base__types.html#ggaac94ee32652dcb53686fdf6881996b6ca19c137733c13835c93db1cc3099c7a83" title="Bad parameter.">UROS_ERR_BADPARAM</a>,</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;            (<span class="stringliteral">&quot;Topic [%.*s] not found\n&quot;</span>, <a class="code" href="group__base__macros.html#ga0944421111e89ed6889954cb67c58bcd" title="Makes the formatted parameters for an UrosString object.">UROS_STRARG</a>(namep)));</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;  <span class="comment">/* Master XMLRPC registerSubscriber() */</span></div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;  err = <a class="code" href="group__rpc__call__funcs.html#ga2dfa564dc6891e14712ccd0043837ae7" title="Retrieve parameter value from server and subscribe to updates to that param.">urosRpcCallUnsubscribeParam</a>(</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;    &amp;cfgp-&gt;<a class="code" href="struct_uros_node_config.html#a433cf14823804cddc8f34870f57f061f" title="ROS Master XMLRPC server address.">masterAddr</a>,</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;    &amp;cfgp-&gt;<a class="code" href="struct_uros_node_config.html#ac2ab2f5d771a355846f4a88bcaf86c39" title="Node name.">nodeName</a>,</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;    &amp;cfgp-&gt;<a class="code" href="struct_uros_node_config.html#aa741eb4fd467dba559ec3f58293f022e" title="XMLRPC Listener URI.">xmlrpcUri</a>,</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;    namep,</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;    &amp;response</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;  );</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;  <a class="code" href="group__base__macros.html#gae2617103c16f3e9d923d712289011471" title="Checks if an error occurred, and generates a message.">urosError</a>(err != <a class="code" href="group__base__types.html#ggaac94ee32652dcb53686fdf6881996b6ca2aa45ad0fcc039cef995b754c97f63ce" title="No errors.">UROS_OK</a>, <span class="keywordflow">goto</span> _finally,</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;            (<span class="stringliteral">&quot;Cannot unsubscribe from param [%.*s]\n&quot;</span>,</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;             <a class="code" href="group__base__macros.html#ga0944421111e89ed6889954cb67c58bcd" title="Makes the formatted parameters for an UrosString object.">UROS_STRARG</a>(namep)));</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;  <span class="comment">/* Check for valid codes.*/</span></div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;  <a class="code" href="group__base__macros.html#gae2617103c16f3e9d923d712289011471" title="Checks if an error occurred, and generates a message.">urosError</a>(response.<a class="code" href="struct_uros_rpc_response.html#a2b2df079d5bf428ca349ecac28bba0ad" title="Response code (.">code</a> != <a class="code" href="group__rpc__types.html#gga17b8b6fc0f50d5d51c58ba1e3259487aa1888553c768a7611c981fa59d40e6fd4" title="Method completed successfully.">UROS_RPCC_SUCCESS</a>,</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;            { <span class="keywordflow">return</span> UROS_ERR_BADPARAM; <span class="keywordflow">goto</span> _finally; },</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;            (<span class="stringliteral">&quot;Response code %ld, expected %d\n&quot;</span>,</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;             response.code, <a class="code" href="group__rpc__types.html#gga17b8b6fc0f50d5d51c58ba1e3259487aa1888553c768a7611c981fa59d40e6fd4" title="Method completed successfully.">UROS_RPCC_SUCCESS</a>));</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;  <a class="code" href="group__base__macros.html#gae2617103c16f3e9d923d712289011471" title="Checks if an error occurred, and generates a message.">urosError</a>(response.httpcode != 200,</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;            { <span class="keywordflow">return</span> <a class="code" href="group__base__types.html#ggaac94ee32652dcb53686fdf6881996b6ca19c137733c13835c93db1cc3099c7a83" title="Bad parameter.">UROS_ERR_BADPARAM</a>; <span class="keywordflow">goto</span> _finally; },</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;            (<span class="stringliteral">&quot;Response HTTP code %ld, expected 200\n&quot;</span>, response.httpcode));</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;  <span class="comment">/* Remove from the subscribed topics list and delete.*/</span></div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;  nodep = <a class="code" href="group__base__funcs.html#ga778761e65942c459b0b3be5049686d0a" title="Removes a node from the list.">urosListRemove</a>(&amp;urosNode.<a class="code" href="struct_uros_node.html#a5824c0ae5741fd90f941e81ce22fac13" title="Node status.">status</a>.<a class="code" href="struct_uros_node_status.html#a808a345aa9bf26dccaf5c348b4da5ec7" title="List of parameter subscriptions.">subParamList</a>, nodep);</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(nodep != NULL);</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;  <a class="code" href="group__base__funcs.html#ga16bb69f7a4f4c18940a3680a41a62f37" title="Deallocates a list node.">urosListNodeDelete</a>(nodep, (<a class="code" href="group__base__types.html#ga3f6900a333ee4b24db9b520c7e55abc8" title="Deletion procedure.">uros_delete_f</a>)<a class="code" href="group__base__funcs.html#ga4d08e89758fa879909cd58df47bf4d94" title="Deallocates a topic descriptor.">urosTopicDelete</a>);</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;  err = <a class="code" href="group__base__types.html#ggaac94ee32652dcb53686fdf6881996b6ca2aa45ad0fcc039cef995b754c97f63ce" title="No errors.">UROS_OK</a>;</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;_finally:</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;  <span class="comment">/* Cleanup and return.*/</span></div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;  <a class="code" href="group__threading__funcs.html#ga35dba778a18d8708fcf957da4e5110b3" title="Unlocks a mutex.">urosMutexUnlock</a>(&amp;urosNode.<a class="code" href="struct_uros_node.html#a5824c0ae5741fd90f941e81ce22fac13" title="Node status.">status</a>.<a class="code" href="struct_uros_node_status.html#a5dc9190bee28e9ded208382d733df660" title="Parameter subscriptions lock.">subParamListLock</a>);</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;  <a class="code" href="group__rpc__funcs.html#ga42e2108515c503cc0e89a65c4361b794" title="Cleans a XMLRPC resposnse.">urosRpcResponseClean</a>(&amp;response);</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;  <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;}</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;<span class="comment"> * @brief   Find new publishers for a given topic.</span></div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;<span class="comment"> * @details Scans through the provided publishers list to look for any new</span></div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;<span class="comment"> *          publishers.</span></div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;<span class="comment"> * @param[in] topicnamep</span></div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;<span class="comment"> *          Pointer to a non-empty string which names the targeted topic.</span></div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;<span class="comment"> * @param[in] publishersp</span></div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;<span class="comment"> *          Pointer to an @p UrosRpcParam with @p UROS_RPCP_ARRAY class.</span></div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;<span class="comment"> *          It contains the list of current publishers, received for example</span></div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;<span class="comment"> *          through a XMLRPC call to @p subscribeTopic(). Each publisher is</span></div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;<span class="comment"> *          addressed by its URI.</span></div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;<span class="comment"> * @param[out] newpubsp</span></div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;<span class="comment"> *          Pointer to an empty list which will be populated by the newly</span></div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;<span class="comment"> *          discovered publishers, if any.</span></div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;<span class="comment"> * @return</span></div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;<span class="comment"> *          Error code.</span></div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01072"></a><span class="lineno"><a class="code" href="group__node__funcs.html#ga289dbcb25897f91da1a881f63c75f190"> 1072</a></span>&#160;<a class="code" href="group__base__types.html#gaac94ee32652dcb53686fdf6881996b6c" title="Error codes enumerator.">uros_err_t</a> <a class="code" href="group__node__funcs.html#ga289dbcb25897f91da1a881f63c75f190" title="Find new publishers for a given topic.">urosNodeFindNewPublishers</a>(<span class="keyword">const</span> <a class="code" href="struct_uros_string.html" title="String object.">UrosString</a> *topicnamep,</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;                                     <span class="keyword">const</span> <a class="code" href="struct_uros_rpc_param.html" title="XMLRPC parameter value.">UrosRpcParam</a> *publishersp,</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;                                     <a class="code" href="struct_uros_list.html" title="Linked list, forward only.">UrosList</a> *newpubsp) {</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;  <a class="code" href="group__base__types.html#gaac94ee32652dcb53686fdf6881996b6c" title="Error codes enumerator.">uros_err_t</a> err;</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;  <span class="keyword">const</span> <a class="code" href="struct_uros_list_node.html" title="List node, forward only.">UrosListNode</a> *tcpnodep;</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;  <span class="keyword">const</span> <a class="code" href="struct_uros_rpc_param_node.html" title="Parameter list node, forward only.">UrosRpcParamNode</a> *paramnodep;</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;  <span class="keyword">const</span> <a class="code" href="struct_uros_tcp_ros_status.html" title="TCPROS connection status object.">UrosTcpRosStatus</a> *tcpstp, *tcpfoundp;</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;  <span class="keyword">const</span> <a class="code" href="struct_uros_string.html" title="String object.">UrosString</a> *urip;</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;  <a class="code" href="struct_uros_addr.html" title="Full address record (IP + port).">UrosAddr</a> pubaddr;</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;  (void)err;</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(<a class="code" href="group__base__funcs.html#ga683b6cffc3b9aa9d349d61e12a87a7bb" title="Checks if a string is not empty.">urosStringNotEmpty</a>(topicnamep));</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(publishersp != NULL);</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(publishersp-&gt;<a class="code" href="struct_uros_rpc_param.html#a72733d090996ae055b31c01048668c9a" title="Parameter class.">class</a> == <a class="code" href="group__rpc__types.html#ggaf03aaf8bc712e088b5b03d1d26473738a7a905086a537bc87623c76318a5dc552" title="Generic array.">UROS_RPCP_ARRAY</a>);</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(publishersp-&gt;<a class="code" href="struct_uros_rpc_param.html#ae3cfef091791bd38978a26ca2133fced" title="Parameter value.">value</a>.<a class="code" href="struct_uros_rpc_param.html#a5526d55090a80b6624b9092726e57526" title="XMLRPC array (list pointer).">listp</a> != NULL);</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(<a class="code" href="group__base__funcs.html#ga23589c831c48304c37d6244e30210bfc" title="Checks if pointing to a valid list object.">urosListIsValid</a>(newpubsp));</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;  <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(newpubsp-&gt;<a class="code" href="struct_uros_list.html#a31c61743c1dd1819ae424243ea460558" title="Number of list entries.">length</a> == 0);</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;  <span class="comment">/* Build a list of newly discovered publishers.*/</span></div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;  <a class="code" href="group__threading__funcs.html#ga1db2c55616b4b1264d778c1ae5f25a83" title="Locks a mutex.">urosMutexLock</a>(&amp;urosNode.<a class="code" href="struct_uros_node.html#a5824c0ae5741fd90f941e81ce22fac13" title="Node status.">status</a>.<a class="code" href="struct_uros_node_status.html#a7d3e5ce542819c78c50f7acc533a87e3" title="Subscribed connections lock.">subTcpListLock</a>);</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;  <span class="keywordflow">for</span> (paramnodep = publishersp-&gt;<a class="code" href="struct_uros_rpc_param.html#ae3cfef091791bd38978a26ca2133fced" title="Parameter value.">value</a>.<a class="code" href="struct_uros_rpc_param.html#a5526d55090a80b6624b9092726e57526" title="XMLRPC array (list pointer).">listp</a>-&gt;<a class="code" href="struct_uros_rpc_param_list.html#ab8a4befcda486e320c88a25772f41a27" title="Pointer to the first parameter.">headp</a>;</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;       paramnodep != NULL;</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;       paramnodep = paramnodep-&gt;<a class="code" href="struct_uros_rpc_param_node.html#a2ca8e3006171cac6c3845400223e6bb4" title="Pointer to the next node.">nextp</a>) {</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;    urip = &amp;paramnodep-&gt;<a class="code" href="struct_uros_rpc_param_node.html#a9db0a32dac1f16a7decc0c7061f9e191" title="Parameter value.">param</a>.<a class="code" href="struct_uros_rpc_param.html#ae3cfef091791bd38978a26ca2133fced" title="Parameter value.">value</a>.<a class="code" href="struct_uros_rpc_param.html#af4580a24278cac3b4b934ad09661fa52" title="XMLRPC string.">string</a>;</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;    err = <a class="code" href="group__conn__funcs.html#ga2620f709a43b802a0037220fc85ff5f1" title="Resolves an URI to a connection address.">urosUriToAddr</a>(urip, &amp;pubaddr);</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;    <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(err == <a class="code" href="group__base__types.html#ggaac94ee32652dcb53686fdf6881996b6ca2aa45ad0fcc039cef995b754c97f63ce" title="No errors.">UROS_OK</a>);</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;    tcpfoundp = NULL;</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;    <span class="keywordflow">for</span> (tcpnodep = urosNode.<a class="code" href="struct_uros_node.html#a5824c0ae5741fd90f941e81ce22fac13" title="Node status.">status</a>.<a class="code" href="struct_uros_node_status.html#ac9a7d523859b45d5bc6d245114c25121" title="Subscribed TCPROS connections.">subTcpList</a>.<a class="code" href="struct_uros_list.html#a94a11e13479a04d2887443d8c55a572b" title="Pointer to the list head node.">headp</a>;</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;         tcpnodep != NULL;</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;         tcpnodep = tcpnodep-&gt;<a class="code" href="struct_uros_list_node.html#aa3109ac041ab790fe3e4d4bfa36d3465" title="Pointer to the next list entry node.">nextp</a>) {</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;      tcpstp = (<span class="keyword">const</span> <a class="code" href="struct_uros_tcp_ros_status.html" title="TCPROS connection status object.">UrosTcpRosStatus</a> *)tcpnodep-&gt;<a class="code" href="struct_uros_list_node.html#ab88d07767307bb2312d50abf2e87833b" title="Generic data pointer.">datap</a>;</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;      if (tcpstp-&gt;<a class="code" href="struct_uros_tcp_ros_status.html#ad2ef0a50c4176a846aaf6898b30d6d3f" title="Topic/Service flags.">flags</a>.<a class="code" href="structuros__topicflags__t.html#a7cfab42a7b27fac28fae7b6f69d4ae73" title="Service/!TcpStatus connection.">service</a> == <a class="code" href="group__base__macros.html#ga9e109897ade099aba061ded6ee7064e9" title="false boolean value.">UROS_FALSE</a>) {</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;        <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(tcpstp-&gt;<a class="code" href="struct_uros_tcp_ros_status.html#afc1b0399b8b6dc23c58672813889a1b4" title="Referenced topic/service.">topicp</a> != NULL);</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;        <span class="keywordflow">if</span> (0 == <a class="code" href="group__base__funcs.html#ga78efe29ebd12a2c10a0b101b5c982612" title="Compares two string objects.">urosStringCmp</a>(&amp;tcpstp-&gt;<a class="code" href="struct_uros_tcp_ros_status.html#afc1b0399b8b6dc23c58672813889a1b4" title="Referenced topic/service.">topicp</a>-&gt;<a class="code" href="struct_uros_topic.html#aeff3ee92d44d0e73582c314410d3d141" title="Topic/Service name.">name</a>, topicnamep)) {</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;          <a class="code" href="group__base__macros.html#ga54eab9e05e9149628d6950a87eb8b6f8" title="Evaluates an assertion.">urosAssert</a>(tcpstp-&gt;<a class="code" href="struct_uros_tcp_ros_status.html#a51f9d90d6d5466e85a8e70ef34acd3c3" title="Connection status pointer.">csp</a> != NULL);</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;          <span class="keywordflow">if</span> (tcpstp-&gt;<a class="code" href="struct_uros_tcp_ros_status.html#a51f9d90d6d5466e85a8e70ef34acd3c3" title="Connection status pointer.">csp</a>-&gt;<a class="code" href="struct_uros_conn.html#a899a129b5cf21da562717b3094850fbb" title="Remote address.">remaddr</a>.<a class="code" href="struct_uros_addr.html#a14bb7d41100bb1cd35d4a79ea9f44d56" title="Network address (IP).">ip</a>.<a class="code" href="union_uros_ip.html#aa800316c57525c3f7ab7e63806268378" title="Packed dword.">dword</a> == pubaddr.<a class="code" href="struct_uros_addr.html#a14bb7d41100bb1cd35d4a79ea9f44d56" title="Network address (IP).">ip</a>.<a class="code" href="union_uros_ip.html#aa800316c57525c3f7ab7e63806268378" title="Packed dword.">dword</a> &amp;&amp;</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;              tcpstp-&gt;<a class="code" href="struct_uros_tcp_ros_status.html#a51f9d90d6d5466e85a8e70ef34acd3c3" title="Connection status pointer.">csp</a>-&gt;<a class="code" href="struct_uros_conn.html#a899a129b5cf21da562717b3094850fbb" title="Remote address.">remaddr</a>.<a class="code" href="struct_uros_addr.html#a3dc073d966e7e4cb97e7d70d2a5a0240" title="Transport layer port.">port</a> == pubaddr.<a class="code" href="struct_uros_addr.html#a3dc073d966e7e4cb97e7d70d2a5a0240" title="Transport layer port.">port</a>) {</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;            tcpfoundp = tcpstp;</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;          }</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;        }</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;      }</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;    }</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;    <span class="keywordflow">if</span> (tcpfoundp == NULL) {</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;      <span class="comment">/* New publisher.*/</span></div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;      <a class="code" href="struct_uros_addr.html" title="Full address record (IP + port).">UrosAddr</a> *addrp = <a class="code" href="group__base__macros.html#gaf5fd0f0a25b126bd46328ab6e956dc2d" title="Allocates a typed object.">urosNew</a>(<a class="code" href="struct_uros_addr.html" title="Full address record (IP + port).">UrosAddr</a>);</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;      <a class="code" href="struct_uros_list_node.html" title="List node, forward only.">UrosListNode</a> *nodep = <a class="code" href="group__base__macros.html#gaf5fd0f0a25b126bd46328ab6e956dc2d" title="Allocates a typed object.">urosNew</a>(<a class="code" href="struct_uros_list_node.html" title="List node, forward only.">UrosListNode</a>);</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;      *addrp = pubaddr;</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;      nodep-&gt;<a class="code" href="struct_uros_list_node.html#ab88d07767307bb2312d50abf2e87833b" title="Generic data pointer.">datap</a> = addrp;</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;      nodep-&gt;<a class="code" href="struct_uros_list_node.html#aa3109ac041ab790fe3e4d4bfa36d3465" title="Pointer to the next list entry node.">nextp</a> = NULL;</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;      <a class="code" href="group__base__funcs.html#gae5808c2f0aeb0a570ae545f7468acdce" title="Adds a node to the list.">urosListAdd</a>(newpubsp, nodep);</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;    }</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;  }</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;  <a class="code" href="group__threading__funcs.html#ga35dba778a18d8708fcf957da4e5110b3" title="Unlocks a mutex.">urosMutexUnlock</a>(&amp;urosNode.<a class="code" href="struct_uros_node.html#a5824c0ae5741fd90f941e81ce22fac13" title="Node status.">status</a>.<a class="code" href="struct_uros_node_status.html#a7d3e5ce542819c78c50f7acc533a87e3" title="Subscribed connections lock.">subTcpListLock</a>);</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="group__base__types.html#ggaac94ee32652dcb53686fdf6881996b6ca2aa45ad0fcc039cef995b754c97f63ce" title="No errors.">UROS_OK</a>;</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;}</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;<span class="comment">/** @} */</span></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
      &copy; 2012 <a href="http://www.polimi.it">Politecnico di Milano</a>
      @ <a href="http://airlab.elet.polimi.it/">AIRLab</a>
      &#160;
      Generated by
      <a href="http://www.doxygen.org/index.html">
      <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.1.2
    </li>
  </ul>
</div>
</body>
</html>
